/* esm.sh - esbuild bundle(minipass@5.0.0) denonext production */
import __Process$ from "node:process";
import { Buffer as __Buffer$ } from "node:buffer";
var __global$ = globalThis || (typeof window !== "undefined" ? window : self);
import $ from"node:events";import G from"node:stream";import k from"node:string_decoder";var Y=typeof __Process$=="object"&&__Process$?__Process$:{stdout:null,stderr:null},V=k.StringDecoder,d=Symbol("EOF"),m=Symbol("maybeEmitEnd"),p=Symbol("emittedEnd"),T=Symbol("emittingEnd"),S=Symbol("emittedError"),O=Symbol("closed"),J=Symbol("read"),A=Symbol("flush"),K=Symbol("flushChunk"),f=Symbol("encoding"),c=Symbol("decoder"),D=Symbol("flowing"),w=Symbol("paused"),b=Symbol("resume"),i=Symbol("buffer"),a=Symbol("pipes"),o=Symbol("bufferLength"),x=Symbol("bufferPush"),F=Symbol("bufferShift"),h=Symbol("objectMode"),r=Symbol("destroyed"),P=Symbol("error"),_=Symbol("emitData"),W=Symbol("emitEnd"),U=Symbol("emitEnd2"),y=Symbol("async"),C=Symbol("abort"),M=Symbol("aborted"),E=Symbol("signal"),L=n=>Promise.resolve().then(n),X=__global$._MP_NO_ITERATOR_SYMBOLS_!=="1",q=X&&Symbol.asyncIterator||Symbol("asyncIterator not implemented"),z=X&&Symbol.iterator||Symbol("iterator not implemented"),tt=n=>n==="end"||n==="finish"||n==="prefinish",et=n=>n instanceof ArrayBuffer||typeof n=="object"&&n.constructor&&n.constructor.name==="ArrayBuffer"&&n.byteLength>=0,st=n=>!__Buffer$.isBuffer(n)&&ArrayBuffer.isView(n),I=class{constructor(t,e,s){this.src=t,this.dest=e,this.opts=s,this.ondrain=()=>t[b](),e.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(){}end(){this.unpipe(),this.opts.end&&this.dest.end()}},v=class extends I{unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(t,e,s){super(t,e,s),this.proxyErrors=l=>e.emit("error",l),t.on("error",this.proxyErrors)}},Q=class n extends G{constructor(t){super(),this[D]=!1,this[w]=!1,this[a]=[],this[i]=[],this[h]=t&&t.objectMode||!1,this[h]?this[f]=null:this[f]=t&&t.encoding||null,this[f]==="buffer"&&(this[f]=null),this[y]=t&&!!t.async||!1,this[c]=this[f]?new V(this[f]):null,this[d]=!1,this[p]=!1,this[T]=!1,this[O]=!1,this[S]=null,this.writable=!0,this.readable=!0,this[o]=0,this[r]=!1,t&&t.debugExposeBuffer===!0&&Object.defineProperty(this,"buffer",{get:()=>this[i]}),t&&t.debugExposePipes===!0&&Object.defineProperty(this,"pipes",{get:()=>this[a]}),this[E]=t&&t.signal,this[M]=!1,this[E]&&(this[E].addEventListener("abort",()=>this[C]()),this[E].aborted&&this[C]())}get bufferLength(){return this[o]}get encoding(){return this[f]}set encoding(t){if(this[h])throw new Error("cannot set encoding in objectMode");if(this[f]&&t!==this[f]&&(this[c]&&this[c].lastNeed||this[o]))throw new Error("cannot change encoding");this[f]!==t&&(this[c]=t?new V(t):null,this[i].length&&(this[i]=this[i].map(e=>this[c].write(e)))),this[f]=t}setEncoding(t){this.encoding=t}get objectMode(){return this[h]}set objectMode(t){this[h]=this[h]||!!t}get async(){return this[y]}set async(t){this[y]=this[y]||!!t}[C](){this[M]=!0,this.emit("abort",this[E].reason),this.destroy(this[E].reason)}get aborted(){return this[M]}set aborted(t){}write(t,e,s){if(this[M])return!1;if(this[d])throw new Error("write after end");if(this[r])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;typeof e=="function"&&(s=e,e="utf8"),e||(e="utf8");let l=this[y]?L:u=>u();return!this[h]&&!__Buffer$.isBuffer(t)&&(st(t)?t=__Buffer$.from(t.buffer,t.byteOffset,t.byteLength):et(t)?t=__Buffer$.from(t):typeof t!="string"&&(this.objectMode=!0)),this[h]?(this.flowing&&this[o]!==0&&this[A](!0),this.flowing?this.emit("data",t):this[x](t),this[o]!==0&&this.emit("readable"),s&&l(s),this.flowing):t.length?(typeof t=="string"&&!(e===this[f]&&!this[c].lastNeed)&&(t=__Buffer$.from(t,e)),__Buffer$.isBuffer(t)&&this[f]&&(t=this[c].write(t)),this.flowing&&this[o]!==0&&this[A](!0),this.flowing?this.emit("data",t):this[x](t),this[o]!==0&&this.emit("readable"),s&&l(s),this.flowing):(this[o]!==0&&this.emit("readable"),s&&l(s),this.flowing)}read(t){if(this[r])return null;if(this[o]===0||t===0||t>this[o])return this[m](),null;this[h]&&(t=null),this[i].length>1&&!this[h]&&(this.encoding?this[i]=[this[i].join("")]:this[i]=[__Buffer$.concat(this[i],this[o])]);let e=this[J](t||null,this[i][0]);return this[m](),e}[J](t,e){return t===e.length||t===null?this[F]():(this[i][0]=e.slice(t),e=e.slice(0,t),this[o]-=t),this.emit("data",e),!this[i].length&&!this[d]&&this.emit("drain"),e}end(t,e,s){return typeof t=="function"&&(s=t,t=null),typeof e=="function"&&(s=e,e="utf8"),t&&this.write(t,e),s&&this.once("end",s),this[d]=!0,this.writable=!1,(this.flowing||!this[w])&&this[m](),this}[b](){this[r]||(this[w]=!1,this[D]=!0,this.emit("resume"),this[i].length?this[A]():this[d]?this[m]():this.emit("drain"))}resume(){return this[b]()}pause(){this[D]=!1,this[w]=!0}get destroyed(){return this[r]}get flowing(){return this[D]}get paused(){return this[w]}[x](t){this[h]?this[o]+=1:this[o]+=t.length,this[i].push(t)}[F](){return this[h]?this[o]-=1:this[o]-=this[i][0].length,this[i].shift()}[A](t){do;while(this[K](this[F]())&&this[i].length);!t&&!this[i].length&&!this[d]&&this.emit("drain")}[K](t){return this.emit("data",t),this.flowing}pipe(t,e){if(this[r])return;let s=this[p];return e=e||{},t===Y.stdout||t===Y.stderr?e.end=!1:e.end=e.end!==!1,e.proxyErrors=!!e.proxyErrors,s?e.end&&t.end():(this[a].push(e.proxyErrors?new v(this,t,e):new I(this,t,e)),this[y]?L(()=>this[b]()):this[b]()),t}unpipe(t){let e=this[a].find(s=>s.dest===t);e&&(this[a].splice(this[a].indexOf(e),1),e.unpipe())}addListener(t,e){return this.on(t,e)}on(t,e){let s=super.on(t,e);return t==="data"&&!this[a].length&&!this.flowing?this[b]():t==="readable"&&this[o]!==0?super.emit("readable"):tt(t)&&this[p]?(super.emit(t),this.removeAllListeners(t)):t==="error"&&this[S]&&(this[y]?L(()=>e.call(this,this[S])):e.call(this,this[S])),s}get emittedEnd(){return this[p]}[m](){!this[T]&&!this[p]&&!this[r]&&this[i].length===0&&this[d]&&(this[T]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[O]&&this.emit("close"),this[T]=!1)}emit(t,e,...s){if(t!=="error"&&t!=="close"&&t!==r&&this[r])return;if(t==="data")return!this[h]&&!e?!1:this[y]?L(()=>this[_](e)):this[_](e);if(t==="end")return this[W]();if(t==="close"){if(this[O]=!0,!this[p]&&!this[r])return;let u=super.emit("close");return this.removeAllListeners("close"),u}else if(t==="error"){this[S]=e,super.emit(P,e);let u=!this[E]||this.listeners("error").length?super.emit("error",e):!1;return this[m](),u}else if(t==="resume"){let u=super.emit("resume");return this[m](),u}else if(t==="finish"||t==="prefinish"){let u=super.emit(t);return this.removeAllListeners(t),u}let l=super.emit(t,e,...s);return this[m](),l}[_](t){for(let s of this[a])s.dest.write(t)===!1&&this.pause();let e=super.emit("data",t);return this[m](),e}[W](){this[p]||(this[p]=!0,this.readable=!1,this[y]?L(()=>this[U]()):this[U]())}[U](){if(this[c]){let e=this[c].end();if(e){for(let s of this[a])s.dest.write(e);super.emit("data",e)}}for(let e of this[a])e.end();let t=super.emit("end");return this.removeAllListeners("end"),t}collect(){let t=[];this[h]||(t.dataLength=0);let e=this.promise();return this.on("data",s=>{t.push(s),this[h]||(t.dataLength+=s.length)}),e.then(()=>t)}concat(){return this[h]?Promise.reject(new Error("cannot concat in objectMode")):this.collect().then(t=>this[h]?Promise.reject(new Error("cannot concat in objectMode")):this[f]?t.join(""):__Buffer$.concat(t,t.dataLength))}promise(){return new Promise((t,e)=>{this.on(r,()=>e(new Error("stream destroyed"))),this.on("error",s=>e(s)),this.on("end",()=>t())})}[q](){let t=!1,e=()=>(this.pause(),t=!0,Promise.resolve({done:!0}));return{next:()=>{if(t)return e();let l=this.read();if(l!==null)return Promise.resolve({done:!1,value:l});if(this[d])return e();let u=null,H=null,B=g=>{this.removeListener("data",j),this.removeListener("end",N),this.removeListener(r,R),e(),H(g)},j=g=>{this.removeListener("error",B),this.removeListener("end",N),this.removeListener(r,R),this.pause(),u({value:g,done:!!this[d]})},N=()=>{this.removeListener("error",B),this.removeListener("data",j),this.removeListener(r,R),e(),u({done:!0})},R=()=>B(new Error("stream destroyed"));return new Promise((g,Z)=>{H=Z,u=g,this.once(r,R),this.once("error",B),this.once("end",N),this.once("data",j)})},throw:e,return:e,[q](){return this}}}[z](){let t=!1,e=()=>(this.pause(),this.removeListener(P,e),this.removeListener(r,e),this.removeListener("end",e),t=!0,{done:!0}),s=()=>{if(t)return e();let l=this.read();return l===null?e():{value:l}};return this.once("end",e),this.once(P,e),this.once(r,e),{next:s,throw:e,return:e,[z](){return this}}}destroy(t){return this[r]?(t?this.emit("error",t):this.emit(r),this):(this[r]=!0,this[i].length=0,this[o]=0,typeof this.close=="function"&&!this[O]&&this.close(),t?this.emit("error",t):this.emit(r),this)}static isStream(t){return!!t&&(t instanceof n||t instanceof G||t instanceof $&&(typeof t.pipe=="function"||typeof t.write=="function"&&typeof t.end=="function"))}};export{Q as Minipass};
//# sourceMappingURL=minipass.mjs.map