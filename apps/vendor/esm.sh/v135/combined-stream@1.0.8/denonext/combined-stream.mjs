/* esm.sh - esbuild bundle(combined-stream@1.0.8) denonext production */
import { Buffer as __Buffer$ } from "node:buffer";
import * as __0$ from "node:util";
import * as __1$ from "node:stream";
import * as __2$ from "/v135/delayed-stream@1.0.0/denonext/delayed-stream.mjs";
var require=n=>{const e=m=>typeof m.default<"u"?m.default:m,c=m=>Object.assign({},m);switch(n){case"util":return e(__0$);case"stream":return e(__1$);case"delayed-stream":return e(__2$);default:throw new Error("module \""+n+"\" not found");}};
var y=Object.create;var h=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var v=Object.getPrototypeOf,b=Object.prototype.hasOwnProperty;var p=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,i)=>(typeof require<"u"?require:e)[i]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var N=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),D=(t,e)=>{for(var i in e)h(t,i,{get:e[i],enumerable:!0})},u=(t,e,i,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of z(e))!b.call(t,n)&&n!==i&&h(t,n,{get:()=>e[n],enumerable:!(o=x(e,n))||o.enumerable});return t},a=(t,e,i)=>(u(t,e,"default"),i&&u(i,e,"default")),_=(t,e,i)=>(i=t!=null?y(v(t)):{},u(e||!t||!t.__esModule?h(i,"default",{value:t,enumerable:!0}):i,t));var f=N((B,S)=>{var L=p("util"),d=p("stream").Stream,c=p("delayed-stream");S.exports=r;function r(){this.writable=!1,this.readable=!0,this.dataSize=0,this.maxDataSize=2*1024*1024,this.pauseStreams=!0,this._released=!1,this._streams=[],this._currentStream=null,this._insideLoop=!1,this._pendingNext=!1}L.inherits(r,d);r.create=function(t){var e=new this;t=t||{};for(var i in t)e[i]=t[i];return e};r.isStreamLike=function(t){return typeof t!="function"&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"&&!__Buffer$.isBuffer(t)};r.prototype.append=function(t){var e=r.isStreamLike(t);if(e){if(!(t instanceof c)){var i=c.create(t,{maxDataSize:1/0,pauseStream:this.pauseStreams});t.on("data",this._checkDataSize.bind(this)),t=i}this._handleErrors(t),this.pauseStreams&&t.pause()}return this._streams.push(t),this};r.prototype.pipe=function(t,e){return d.prototype.pipe.call(this,t,e),this.resume(),t};r.prototype._getNext=function(){if(this._currentStream=null,this._insideLoop){this._pendingNext=!0;return}this._insideLoop=!0;try{do this._pendingNext=!1,this._realGetNext();while(this._pendingNext)}finally{this._insideLoop=!1}};r.prototype._realGetNext=function(){var t=this._streams.shift();if(typeof t>"u"){this.end();return}if(typeof t!="function"){this._pipeNext(t);return}var e=t;e(function(i){var o=r.isStreamLike(i);o&&(i.on("data",this._checkDataSize.bind(this)),this._handleErrors(i)),this._pipeNext(i)}.bind(this))};r.prototype._pipeNext=function(t){this._currentStream=t;var e=r.isStreamLike(t);if(e){t.on("end",this._getNext.bind(this)),t.pipe(this,{end:!1});return}var i=t;this.write(i),this._getNext()};r.prototype._handleErrors=function(t){var e=this;t.on("error",function(i){e._emitError(i)})};r.prototype.write=function(t){this.emit("data",t)};r.prototype.pause=function(){this.pauseStreams&&(this.pauseStreams&&this._currentStream&&typeof this._currentStream.pause=="function"&&this._currentStream.pause(),this.emit("pause"))};r.prototype.resume=function(){this._released||(this._released=!0,this.writable=!0,this._getNext()),this.pauseStreams&&this._currentStream&&typeof this._currentStream.resume=="function"&&this._currentStream.resume(),this.emit("resume")};r.prototype.end=function(){this._reset(),this.emit("end")};r.prototype.destroy=function(){this._reset(),this.emit("close")};r.prototype._reset=function(){this.writable=!1,this._streams=[],this._currentStream=null};r.prototype._checkDataSize=function(){if(this._updateDataSize(),!(this.dataSize<=this.maxDataSize)){var t="DelayedStream#maxDataSize of "+this.maxDataSize+" bytes exceeded.";this._emitError(new Error(t))}};r.prototype._updateDataSize=function(){this.dataSize=0;var t=this;this._streams.forEach(function(e){e.dataSize&&(t.dataSize+=e.dataSize)}),this._currentStream&&this._currentStream.dataSize&&(this.dataSize+=this._currentStream.dataSize)};r.prototype._emitError=function(t){this._reset(),this.emit("error",t)}});var s={};D(s,{create:()=>g,default:()=>E,isStreamLike:()=>k});var l=_(f());a(s,_(f()));var{create:g,isStreamLike:k}=l,{default:m,...w}=l,E=m!==void 0?m:w;export{g as create,E as default,k as isStreamLike};
//# sourceMappingURL=combined-stream.mjs.map