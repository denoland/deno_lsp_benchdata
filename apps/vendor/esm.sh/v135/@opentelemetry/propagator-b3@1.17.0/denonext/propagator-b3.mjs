/* esm.sh - esbuild bundle(@opentelemetry/propagator-b3@1.17.0) denonext production */
import{isTracingSuppressed as Z}from"/v135/@opentelemetry/core@1.17.0/denonext/core.mjs";import{isSpanContextValid as b,isValidSpanId as M,isValidTraceId as N,trace as D,TraceFlags as f}from"/v135/@opentelemetry/api@1.6.0/denonext/api.mjs";import{isTracingSuppressed as F}from"/v135/@opentelemetry/core@1.17.0/denonext/core.mjs";import{createContextKey as L}from"/v135/@opentelemetry/api@1.6.0/denonext/api.mjs";var u=L("OpenTelemetry Context Key B3 Debug Flag");var s="b3",_="x-b3-traceid",l="x-b3-spanid",d="x-b3-sampled",m="x-b3-parentspanid",g="x-b3-flags";var C=new Set([!0,"true","True","1",1]),V=new Set([!1,"false","False","0",0]);function R(r){return r===f.SAMPLED||r===f.NONE}function X(r){return Array.isArray(r)?r[0]:r}function c(r,t,e){var n=t.get(r,e);return X(n)}function G(r,t){var e=c(r,t,_);return typeof e=="string"?e.padStart(32,"0"):""}function U(r,t){var e=c(r,t,l);return typeof e=="string"?e:""}function I(r,t){var e=c(r,t,g);return e==="1"?"1":void 0}function H(r,t){var e=c(r,t,d),n=I(r,t);if(n==="1"||C.has(e))return f.SAMPLED;if(e===void 0||V.has(e))return f.NONE}var P=function(){function r(){}return r.prototype.inject=function(t,e,n){var a=D.getSpanContext(t);if(!(!a||!b(a)||F(t))){var i=t.getValue(u);n.set(e,_,a.traceId),n.set(e,l,a.spanId),i==="1"?n.set(e,g,i):a.traceFlags!==void 0&&n.set(e,d,(f.SAMPLED&a.traceFlags)===f.SAMPLED?"1":"0")}},r.prototype.extract=function(t,e,n){var a=G(e,n),i=U(e,n),o=H(e,n),p=I(e,n);return N(a)&&M(i)&&R(o)?(t=t.setValue(u,p),D.setSpanContext(t,{traceId:a,spanId:i,isRemote:!0,traceFlags:o})):t},r.prototype.fields=function(){return[_,l,g,d,m]},r}();import{isSpanContextValid as O,isValidSpanId as w,isValidTraceId as K,trace as T,TraceFlags as B}from"/v135/@opentelemetry/api@1.6.0/denonext/api.mjs";import{isTracingSuppressed as Y}from"/v135/@opentelemetry/core@1.17.0/denonext/core.mjs";var j=function(r,t){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var n=e.call(r),a,i=[],o;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(p){o={error:p}}finally{try{a&&!a.done&&(e=n.return)&&e.call(n)}finally{if(o)throw o.error}}return i},k=/((?:[0-9a-f]{16}){1,2})-([0-9a-f]{16})(?:-([01d](?![0-9a-f])))?(?:-([0-9a-f]{16}))?/,q="0".repeat(16),z=new Set(["d","1"]),J="d";function Q(r){return r.length===32?r:""+q+r}function W(r){return r&&z.has(r)?B.SAMPLED:B.NONE}var y=function(){function r(){}return r.prototype.inject=function(t,e,n){var a=T.getSpanContext(t);if(!(!a||!O(a)||Y(t))){var i=t.getValue(u)||a.traceFlags&1,o=a.traceId+"-"+a.spanId+"-"+i;n.set(e,s,o)}},r.prototype.extract=function(t,e,n){var a=n.get(e,s),i=Array.isArray(a)?a[0]:a;if(typeof i!="string")return t;var o=i.match(k);if(!o)return t;var p=j(o,4),h=p[1],S=p[2],v=p[3],A=Q(h);if(!K(A)||!w(S))return t;var x=W(v);return v===J&&(t=t.setValue(u,v)),T.setSpanContext(t,{traceId:A,spanId:S,isRemote:!0,traceFlags:x})},r.prototype.fields=function(){return[s]},r}();var E;(function(r){r[r.SINGLE_HEADER=0]="SINGLE_HEADER",r[r.MULTI_HEADER=1]="MULTI_HEADER"})(E||(E={}));var Sr=function(){function r(t){t===void 0&&(t={}),this._b3MultiPropagator=new P,this._b3SinglePropagator=new y,t.injectEncoding===E.MULTI_HEADER?(this._inject=this._b3MultiPropagator.inject,this._fields=this._b3MultiPropagator.fields()):(this._inject=this._b3SinglePropagator.inject,this._fields=this._b3SinglePropagator.fields())}return r.prototype.inject=function(t,e,n){Z(t)||this._inject(t,e,n)},r.prototype.extract=function(t,e,n){var a=n.get(e,s),i=Array.isArray(a)?a[0]:a;return i?this._b3SinglePropagator.extract(t,e,n):this._b3MultiPropagator.extract(t,e,n)},r.prototype.fields=function(){return this._fields},r}();export{E as B3InjectEncoding,Sr as B3Propagator,s as B3_CONTEXT_HEADER,g as X_B3_FLAGS,m as X_B3_PARENT_SPAN_ID,d as X_B3_SAMPLED,l as X_B3_SPAN_ID,_ as X_B3_TRACE_ID};
//# sourceMappingURL=propagator-b3.mjs.map