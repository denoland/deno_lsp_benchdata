/* esm.sh - esbuild bundle(@opentelemetry/sdk-trace-base@1.17.0) denonext production */
import*as l from"/v135/@opentelemetry/api@1.6.0/denonext/api.mjs";import{sanitizeAttributes as D,isTracingSuppressed as zt}from"/v135/@opentelemetry/core@1.17.0/denonext/core.mjs";import{diag as h,SpanStatusCode as ht}from"/v135/@opentelemetry/api@1.6.0/denonext/api.mjs";import{addHrTimes as mt,millisToHrTime as A,getTimeOrigin as _t,hrTime as vt,hrTimeDuration as St,isAttributeValue as Et,isTimeInput as X,isTimeInputHrTime as yt,otperformance as I,sanitizeAttributes as Tt}from"/v135/@opentelemetry/core@1.17.0/denonext/core.mjs";import{SemanticAttributes as E}from"/v135/@opentelemetry/semantic-conventions@1.17.0/denonext/semantic-conventions.mjs";var k="exception";var ct=function(r){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&r[t],n=0;if(e)return e.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},dt=function(r,t){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var n=e.call(r),o,i=[],a;try{for(;(t===void 0||t-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(e=n.return)&&e.call(n)}finally{if(a)throw a.error}}return i},Q=function(){function r(t,e,n,o,i,a,s,p,u){s===void 0&&(s=[]),this.attributes={},this.links=[],this.events=[],this._droppedAttributesCount=0,this._droppedEventsCount=0,this._droppedLinksCount=0,this.status={code:ht.UNSET},this.endTime=[0,0],this._ended=!1,this._duration=[-1,-1],this.name=n,this._spanContext=o,this.parentSpanId=a,this.kind=i,this.links=s;var f=Date.now();this._performanceStartTime=I.now(),this._performanceOffset=f-(this._performanceStartTime+_t()),this._startTimeProvided=p!=null,this.startTime=this._getTime(p??f),this.resource=t.resource,this.instrumentationLibrary=t.instrumentationLibrary,this._spanLimits=t.getSpanLimits(),this._spanProcessor=t.getActiveSpanProcessor(),this._spanProcessor.onStart(this,e),this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0}return r.prototype.spanContext=function(){return this._spanContext},r.prototype.setAttribute=function(t,e){return e==null||this._isSpanEnded()?this:t.length===0?(h.warn("Invalid attribute key: "+t),this):Et(e)?Object.keys(this.attributes).length>=this._spanLimits.attributeCountLimit&&!Object.prototype.hasOwnProperty.call(this.attributes,t)?(this._droppedAttributesCount++,this):(this.attributes[t]=this._truncateToSize(e),this):(h.warn("Invalid attribute value set for key: "+t),this)},r.prototype.setAttributes=function(t){var e,n;try{for(var o=ct(Object.entries(t)),i=o.next();!i.done;i=o.next()){var a=dt(i.value,2),s=a[0],p=a[1];this.setAttribute(s,p)}}catch(u){e={error:u}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return this},r.prototype.addEvent=function(t,e,n){if(this._isSpanEnded())return this;if(this._spanLimits.eventCountLimit===0)return h.warn("No events allowed."),this._droppedEventsCount++,this;this.events.length>=this._spanLimits.eventCountLimit&&(h.warn("Dropping extra events."),this.events.shift(),this._droppedEventsCount++),X(e)&&(X(n)||(n=e),e=void 0);var o=Tt(e);return this.events.push({name:t,attributes:o,time:this._getTime(n),droppedAttributesCount:0}),this},r.prototype.setStatus=function(t){return this._isSpanEnded()?this:(this.status=t,this)},r.prototype.updateName=function(t){return this._isSpanEnded()?this:(this.name=t,this)},r.prototype.end=function(t){if(this._isSpanEnded()){h.error(this.name+" "+this._spanContext.traceId+"-"+this._spanContext.spanId+" - You can only call end() on a span once.");return}this._ended=!0,this.endTime=this._getTime(t),this._duration=St(this.startTime,this.endTime),this._duration[0]<0&&(h.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._spanProcessor.onEnd(this)},r.prototype._getTime=function(t){if(typeof t=="number"&&t<I.now())return vt(t+this._performanceOffset);if(typeof t=="number")return A(t);if(t instanceof Date)return A(t.getTime());if(yt(t))return t;if(this._startTimeProvided)return A(Date.now());var e=I.now()-this._performanceStartTime;return mt(this.startTime,A(e))},r.prototype.isRecording=function(){return this._ended===!1},r.prototype.recordException=function(t,e){var n={};typeof t=="string"?n[E.EXCEPTION_MESSAGE]=t:t&&(t.code?n[E.EXCEPTION_TYPE]=t.code.toString():t.name&&(n[E.EXCEPTION_TYPE]=t.name),t.message&&(n[E.EXCEPTION_MESSAGE]=t.message),t.stack&&(n[E.EXCEPTION_STACKTRACE]=t.stack)),n[E.EXCEPTION_TYPE]||n[E.EXCEPTION_MESSAGE]?this.addEvent(k,n,e):h.warn("Failed to record an exception "+t)},Object.defineProperty(r.prototype,"duration",{get:function(){return this._duration},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"ended",{get:function(){return this._ended},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"droppedAttributesCount",{get:function(){return this._droppedAttributesCount},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"droppedEventsCount",{get:function(){return this._droppedEventsCount},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"droppedLinksCount",{get:function(){return this._droppedLinksCount},enumerable:!1,configurable:!0}),r.prototype._isSpanEnded=function(){return this._ended&&h.warn("Can not execute the operation on ended Span {traceId: "+this._spanContext.traceId+", spanId: "+this._spanContext.spanId+"}"),this._ended},r.prototype._truncateToLimitUtil=function(t,e){return t.length<=e?t:t.substr(0,e)},r.prototype._truncateToSize=function(t){var e=this,n=this._attributeValueLengthLimit;return n<=0?(h.warn("Attribute value limit must be positive, got "+n),t):typeof t=="string"?this._truncateToLimitUtil(t,n):Array.isArray(t)?t.map(function(o){return typeof o=="string"?e._truncateToLimitUtil(o,n):o}):t},r}();import{diag as b}from"/v135/@opentelemetry/api@1.6.0/denonext/api.mjs";import{getEnv as d,TracesSamplerValues as y}from"/v135/@opentelemetry/core@1.17.0/denonext/core.mjs";var m;(function(r){r[r.NOT_RECORD=0]="NOT_RECORD",r[r.RECORD=1]="RECORD",r[r.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"})(m||(m={}));var L=function(){function r(){}return r.prototype.shouldSample=function(){return{decision:m.NOT_RECORD}},r.prototype.toString=function(){return"AlwaysOffSampler"},r}();var v=function(){function r(){}return r.prototype.shouldSample=function(){return{decision:m.RECORD_AND_SAMPLED}},r.prototype.toString=function(){return"AlwaysOnSampler"},r}();import{isSpanContextValid as gt,TraceFlags as Y,trace as Lt}from"/v135/@opentelemetry/api@1.6.0/denonext/api.mjs";import{globalErrorHandler as Pt}from"/v135/@opentelemetry/core@1.17.0/denonext/core.mjs";var w=function(){function r(t){var e,n,o,i;this._root=t.root,this._root||(Pt(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new v),this._remoteParentSampled=(e=t.remoteParentSampled)!==null&&e!==void 0?e:new v,this._remoteParentNotSampled=(n=t.remoteParentNotSampled)!==null&&n!==void 0?n:new L,this._localParentSampled=(o=t.localParentSampled)!==null&&o!==void 0?o:new v,this._localParentNotSampled=(i=t.localParentNotSampled)!==null&&i!==void 0?i:new L}return r.prototype.shouldSample=function(t,e,n,o,i,a){var s=Lt.getSpanContext(t);return!s||!gt(s)?this._root.shouldSample(t,e,n,o,i,a):s.isRemote?s.traceFlags&Y.SAMPLED?this._remoteParentSampled.shouldSample(t,e,n,o,i,a):this._remoteParentNotSampled.shouldSample(t,e,n,o,i,a):s.traceFlags&Y.SAMPLED?this._localParentSampled.shouldSample(t,e,n,o,i,a):this._localParentNotSampled.shouldSample(t,e,n,o,i,a)},r.prototype.toString=function(){return"ParentBased{root="+this._root.toString()+", remoteParentSampled="+this._remoteParentSampled.toString()+", remoteParentNotSampled="+this._remoteParentNotSampled.toString()+", localParentSampled="+this._localParentSampled.toString()+", localParentNotSampled="+this._localParentNotSampled.toString()+"}"},r}();import{isValidTraceId as xt}from"/v135/@opentelemetry/api@1.6.0/denonext/api.mjs";var N=function(){function r(t){t===void 0&&(t=0),this._ratio=t,this._ratio=this._normalize(t),this._upperBound=Math.floor(this._ratio*4294967295)}return r.prototype.shouldSample=function(t,e){return{decision:xt(e)&&this._accumulate(e)<this._upperBound?m.RECORD_AND_SAMPLED:m.NOT_RECORD}},r.prototype.toString=function(){return"TraceIdRatioBased{"+this._ratio+"}"},r.prototype._normalize=function(t){return typeof t!="number"||isNaN(t)?0:t>=1?1:t<=0?0:t},r.prototype._accumulate=function(t){for(var e=0,n=0;n<t.length/8;n++){var o=n*8,i=parseInt(t.slice(o,o+8),16);e=(e^i)>>>0}return e},r}();var At=d(),wt=y.AlwaysOn,P=1;function C(){return{sampler:M(At),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:d().OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:d().OTEL_ATTRIBUTE_COUNT_LIMIT},spanLimits:{attributeValueLengthLimit:d().OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:d().OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT,linkCountLimit:d().OTEL_SPAN_LINK_COUNT_LIMIT,eventCountLimit:d().OTEL_SPAN_EVENT_COUNT_LIMIT,attributePerEventCountLimit:d().OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT,attributePerLinkCountLimit:d().OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT}}}function M(r){switch(r===void 0&&(r=d()),r.OTEL_TRACES_SAMPLER){case y.AlwaysOn:return new v;case y.AlwaysOff:return new L;case y.ParentBasedAlwaysOn:return new w({root:new v});case y.ParentBasedAlwaysOff:return new w({root:new L});case y.TraceIdRatio:return new N(q(r));case y.ParentBasedTraceIdRatio:return new w({root:new N(q(r))});default:return b.error('OTEL_TRACES_SAMPLER value "'+r.OTEL_TRACES_SAMPLER+" invalid, defaulting to "+wt+'".'),new v}}function q(r){if(r.OTEL_TRACES_SAMPLER_ARG===void 0||r.OTEL_TRACES_SAMPLER_ARG==="")return b.error("OTEL_TRACES_SAMPLER_ARG is blank, defaulting to "+P+"."),P;var t=Number(r.OTEL_TRACES_SAMPLER_ARG);return isNaN(t)?(b.error("OTEL_TRACES_SAMPLER_ARG="+r.OTEL_TRACES_SAMPLER_ARG+" was given, but it is invalid, defaulting to "+P+"."),P):t<0||t>1?(b.error("OTEL_TRACES_SAMPLER_ARG="+r.OTEL_TRACES_SAMPLER_ARG+" was given, but it is out of range ([0..1]), defaulting to "+P+"."),P):t}import{DEFAULT_ATTRIBUTE_COUNT_LIMIT as bt,DEFAULT_ATTRIBUTE_VALUE_LENGTH_LIMIT as Ct,getEnvWithoutDefaults as Ot}from"/v135/@opentelemetry/core@1.17.0/denonext/core.mjs";function W(r){var t={sampler:M()},e=C(),n=Object.assign({},e,t,r);return n.generalLimits=Object.assign({},e.generalLimits,r.generalLimits||{}),n.spanLimits=Object.assign({},e.spanLimits,r.spanLimits||{}),n}function K(r){var t,e,n,o,i,a,s,p,u,f,c,_,g=Object.assign({},r.spanLimits),S=Ot();return g.attributeCountLimit=(a=(i=(o=(e=(t=r.spanLimits)===null||t===void 0?void 0:t.attributeCountLimit)!==null&&e!==void 0?e:(n=r.generalLimits)===null||n===void 0?void 0:n.attributeCountLimit)!==null&&o!==void 0?o:S.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT)!==null&&i!==void 0?i:S.OTEL_ATTRIBUTE_COUNT_LIMIT)!==null&&a!==void 0?a:bt,g.attributeValueLengthLimit=(_=(c=(f=(p=(s=r.spanLimits)===null||s===void 0?void 0:s.attributeValueLengthLimit)!==null&&p!==void 0?p:(u=r.generalLimits)===null||u===void 0?void 0:u.attributeValueLengthLimit)!==null&&f!==void 0?f:S.OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT)!==null&&c!==void 0?c:S.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT)!==null&&_!==void 0?_:Ct,Object.assign({},r,{spanLimits:g})}import{context as Z,diag as B,TraceFlags as Rt}from"/v135/@opentelemetry/api@1.6.0/denonext/api.mjs";import{BindOnceFuture as It,ExportResultCode as Nt,getEnv as Mt,globalErrorHandler as J,suppressTracing as Bt,unrefTimer as Dt}from"/v135/@opentelemetry/core@1.17.0/denonext/core.mjs";var $=function(){function r(t,e){this._exporter=t,this._finishedSpans=[],this._droppedSpansCount=0;var n=Mt();this._maxExportBatchSize=typeof e?.maxExportBatchSize=="number"?e.maxExportBatchSize:n.OTEL_BSP_MAX_EXPORT_BATCH_SIZE,this._maxQueueSize=typeof e?.maxQueueSize=="number"?e.maxQueueSize:n.OTEL_BSP_MAX_QUEUE_SIZE,this._scheduledDelayMillis=typeof e?.scheduledDelayMillis=="number"?e.scheduledDelayMillis:n.OTEL_BSP_SCHEDULE_DELAY,this._exportTimeoutMillis=typeof e?.exportTimeoutMillis=="number"?e.exportTimeoutMillis:n.OTEL_BSP_EXPORT_TIMEOUT,this._shutdownOnce=new It(this._shutdown,this),this._maxExportBatchSize>this._maxQueueSize&&(B.warn("BatchSpanProcessor: maxExportBatchSize must be smaller or equal to maxQueueSize, setting maxExportBatchSize to match maxQueueSize"),this._maxExportBatchSize=this._maxQueueSize)}return r.prototype.forceFlush=function(){return this._shutdownOnce.isCalled?this._shutdownOnce.promise:this._flushAll()},r.prototype.onStart=function(t,e){},r.prototype.onEnd=function(t){this._shutdownOnce.isCalled||t.spanContext().traceFlags&Rt.SAMPLED&&this._addToBuffer(t)},r.prototype.shutdown=function(){return this._shutdownOnce.call()},r.prototype._shutdown=function(){var t=this;return Promise.resolve().then(function(){return t.onShutdown()}).then(function(){return t._flushAll()}).then(function(){return t._exporter.shutdown()})},r.prototype._addToBuffer=function(t){if(this._finishedSpans.length>=this._maxQueueSize){this._droppedSpansCount===0&&B.debug("maxQueueSize reached, dropping spans"),this._droppedSpansCount++;return}this._droppedSpansCount>0&&(B.warn("Dropped "+this._droppedSpansCount+" spans because maxQueueSize reached"),this._droppedSpansCount=0),this._finishedSpans.push(t),this._maybeStartTimer()},r.prototype._flushAll=function(){var t=this;return new Promise(function(e,n){for(var o=[],i=Math.ceil(t._finishedSpans.length/t._maxExportBatchSize),a=0,s=i;a<s;a++)o.push(t._flushOneBatch());Promise.all(o).then(function(){e()}).catch(n)})},r.prototype._flushOneBatch=function(){var t=this;return this._clearTimer(),this._finishedSpans.length===0?Promise.resolve():new Promise(function(e,n){var o=setTimeout(function(){n(new Error("Timeout"))},t._exportTimeoutMillis);Z.with(Bt(Z.active()),function(){var i=t._finishedSpans.splice(0,t._maxExportBatchSize),a=function(){return t._exporter.export(i,function(p){var u;clearTimeout(o),p.code===Nt.SUCCESS?e():n((u=p.error)!==null&&u!==void 0?u:new Error("BatchSpanProcessor: span export failed"))})},s=i.map(function(p){return p.resource}).filter(function(p){return p.asyncAttributesPending});s.length===0?a():Promise.all(s.map(function(p){var u;return(u=p.waitForAsyncAttributes)===null||u===void 0?void 0:u.call(p)})).then(a,function(p){J(p),n(p)})})})},r.prototype._maybeStartTimer=function(){var t=this;this._timer===void 0&&(this._timer=setTimeout(function(){t._flushOneBatch().then(function(){t._finishedSpans.length>0&&(t._clearTimer(),t._maybeStartTimer())}).catch(function(e){J(e)})},this._scheduledDelayMillis),Dt(this._timer))},r.prototype._clearTimer=function(){this._timer!==void 0&&(clearTimeout(this._timer),this._timer=void 0)},r}();var Ut=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),tt=function(r){Ut(t,r);function t(e,n){var o=r.call(this,e,n)||this;return o.onInit(n),o}return t.prototype.onInit=function(e){var n=this;e?.disableAutoFlushOnDocumentHide!==!0&&typeof document<"u"&&(this._visibilityChangeListener=function(){document.visibilityState==="hidden"&&n.forceFlush()},this._pageHideListener=function(){n.forceFlush()},document.addEventListener("visibilitychange",this._visibilityChangeListener),document.addEventListener("pagehide",this._pageHideListener))},t.prototype.onShutdown=function(){typeof document<"u"&&(this._visibilityChangeListener&&document.removeEventListener("visibilitychange",this._visibilityChangeListener),this._pageHideListener&&document.removeEventListener("pagehide",this._pageHideListener))},t}($);var Ft=8,Gt=16,rt=function(){function r(){this.generateTraceId=et(Gt),this.generateSpanId=et(Ft)}return r}();var O=Array(32);function et(r){return function(){for(var e=0;e<r*2;e++)O[e]=Math.floor(Math.random()*16)+48,O[e]>=58&&(O[e]+=39);return String.fromCharCode.apply(null,O.slice(0,r*2))}}var nt=function(){function r(t,e,n){this._tracerProvider=n;var o=W(e);this._sampler=o.sampler,this._generalLimits=o.generalLimits,this._spanLimits=o.spanLimits,this._idGenerator=e.idGenerator||new rt,this.resource=n.resource,this.instrumentationLibrary=t}return r.prototype.startSpan=function(t,e,n){var o,i,a;e===void 0&&(e={}),n===void 0&&(n=l.context.active()),e.root&&(n=l.trace.deleteSpan(n));var s=l.trace.getSpan(n);if(zt(n)){l.diag.debug("Instrumentation suppressed, returning Noop Span");var p=l.trace.wrapSpanContext(l.INVALID_SPAN_CONTEXT);return p}var u=s?.spanContext(),f=this._idGenerator.generateSpanId(),c,_,g;!u||!l.trace.isSpanContextValid(u)?c=this._idGenerator.generateTraceId():(c=u.traceId,_=u.traceState,g=u.spanId);var S=(o=e.kind)!==null&&o!==void 0?o:l.SpanKind.INTERNAL,G=((i=e.links)!==null&&i!==void 0?i:[]).map(function(j){return{context:j.context,attributes:D(j.attributes)}}),z=D(e.attributes),x=this._sampler.shouldSample(n,c,t,S,z,G);_=(a=x.traceState)!==null&&a!==void 0?a:_;var lt=x.decision===l.SamplingDecision.RECORD_AND_SAMPLED?l.TraceFlags.SAMPLED:l.TraceFlags.NONE,H={traceId:c,spanId:f,traceFlags:lt,traceState:_};if(x.decision===l.SamplingDecision.NOT_RECORD){l.diag.debug("Recording is off, propagating context in a non-recording span");var p=l.trace.wrapSpanContext(H);return p}var V=new Q(this,n,t,H,S,g,G,e.startTime),ft=D(Object.assign(z,x.attributes));return V.setAttributes(ft),V},r.prototype.startActiveSpan=function(t,e,n,o){var i,a,s;if(!(arguments.length<2)){arguments.length===2?s=e:arguments.length===3?(i=e,s=n):(i=e,a=n,s=o);var p=a??l.context.active(),u=this.startSpan(t,i,p),f=l.trace.setSpan(p,u);return l.context.with(f,s,void 0,u)}},r.prototype.getGeneralLimits=function(){return this._generalLimits},r.prototype.getSpanLimits=function(){return this._spanLimits},r.prototype.getActiveSpanProcessor=function(){return this._tracerProvider.getActiveSpanProcessor()},r}();import{context as Vt,diag as U,propagation as jt,trace as kt}from"/v135/@opentelemetry/api@1.6.0/denonext/api.mjs";import{CompositePropagator as Xt,W3CBaggagePropagator as Qt,W3CTraceContextPropagator as Yt,getEnv as at,merge as qt}from"/v135/@opentelemetry/core@1.17.0/denonext/core.mjs";import{Resource as st}from"/v135/@opentelemetry/resources@1.17.0/denonext/resources.mjs";import{globalErrorHandler as Ht}from"/v135/@opentelemetry/core@1.17.0/denonext/core.mjs";var R=function(r){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&r[t],n=0;if(e)return e.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},it=function(){function r(t){this._spanProcessors=t}return r.prototype.forceFlush=function(){var t,e,n=[];try{for(var o=R(this._spanProcessors),i=o.next();!i.done;i=o.next()){var a=i.value;n.push(a.forceFlush())}}catch(s){t={error:s}}finally{try{i&&!i.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}return new Promise(function(s){Promise.all(n).then(function(){s()}).catch(function(p){Ht(p||new Error("MultiSpanProcessor: forceFlush failed")),s()})})},r.prototype.onStart=function(t,e){var n,o;try{for(var i=R(this._spanProcessors),a=i.next();!a.done;a=i.next()){var s=a.value;s.onStart(t,e)}}catch(p){n={error:p}}finally{try{a&&!a.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}},r.prototype.onEnd=function(t){var e,n;try{for(var o=R(this._spanProcessors),i=o.next();!i.done;i=o.next()){var a=i.value;a.onEnd(t)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}},r.prototype.shutdown=function(){var t,e,n=[];try{for(var o=R(this._spanProcessors),i=o.next();!i.done;i=o.next()){var a=i.value;n.push(a.shutdown())}}catch(s){t={error:s}}finally{try{i&&!i.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}return new Promise(function(s,p){Promise.all(n).then(function(){s()},p)})},r}();var ot=function(){function r(){}return r.prototype.onStart=function(t,e){},r.prototype.onEnd=function(t){},r.prototype.shutdown=function(){return Promise.resolve()},r.prototype.forceFlush=function(){return Promise.resolve()},r}();var T;(function(r){r[r.resolved=0]="resolved",r[r.timeout=1]="timeout",r[r.error=2]="error",r[r.unresolved=3]="unresolved"})(T||(T={}));var nr=function(){function r(t){t===void 0&&(t={});var e;this._registeredSpanProcessors=[],this._tracers=new Map;var n=qt({},C(),K(t));this.resource=(e=n.resource)!==null&&e!==void 0?e:st.empty(),this.resource=st.default().merge(this.resource),this._config=Object.assign({},n,{resource:this.resource});var o=this._buildExporterFromEnv();if(o!==void 0){var i=new tt(o);this.activeSpanProcessor=i}else this.activeSpanProcessor=new ot}return r.prototype.getTracer=function(t,e,n){var o=t+"@"+(e||"")+":"+(n?.schemaUrl||"");return this._tracers.has(o)||this._tracers.set(o,new nt({name:t,version:e,schemaUrl:n?.schemaUrl},this._config,this)),this._tracers.get(o)},r.prototype.addSpanProcessor=function(t){this._registeredSpanProcessors.length===0&&this.activeSpanProcessor.shutdown().catch(function(e){return U.error("Error while trying to shutdown current span processor",e)}),this._registeredSpanProcessors.push(t),this.activeSpanProcessor=new it(this._registeredSpanProcessors)},r.prototype.getActiveSpanProcessor=function(){return this.activeSpanProcessor},r.prototype.register=function(t){t===void 0&&(t={}),kt.setGlobalTracerProvider(this),t.propagator===void 0&&(t.propagator=this._buildPropagatorFromEnv()),t.contextManager&&Vt.setGlobalContextManager(t.contextManager),t.propagator&&jt.setGlobalPropagator(t.propagator)},r.prototype.forceFlush=function(){var t=this._config.forceFlushTimeoutMillis,e=this._registeredSpanProcessors.map(function(n){return new Promise(function(o){var i,a=setTimeout(function(){o(new Error("Span processor did not completed within timeout period of "+t+" ms")),i=T.timeout},t);n.forceFlush().then(function(){clearTimeout(a),i!==T.timeout&&(i=T.resolved,o(i))}).catch(function(s){clearTimeout(a),i=T.error,o(s)})})});return new Promise(function(n,o){Promise.all(e).then(function(i){var a=i.filter(function(s){return s!==T.resolved});a.length>0?o(a):n()}).catch(function(i){return o([i])})})},r.prototype.shutdown=function(){return this.activeSpanProcessor.shutdown()},r.prototype._getPropagator=function(t){var e;return(e=this.constructor._registeredPropagators.get(t))===null||e===void 0?void 0:e()},r.prototype._getSpanExporter=function(t){var e;return(e=this.constructor._registeredExporters.get(t))===null||e===void 0?void 0:e()},r.prototype._buildPropagatorFromEnv=function(){var t=this,e=Array.from(new Set(at().OTEL_PROPAGATORS)),n=e.map(function(i){var a=t._getPropagator(i);return a||U.warn('Propagator "'+i+'" requested through environment variable is unavailable.'),a}),o=n.reduce(function(i,a){return a&&i.push(a),i},[]);if(o.length!==0)return e.length===1?o[0]:new Xt({propagators:o})},r.prototype._buildExporterFromEnv=function(){var t=at().OTEL_TRACES_EXPORTER;if(!(t==="none"||t==="")){var e=this._getSpanExporter(t);return e||U.error('Exporter "'+t+'" requested through environment variable is unavailable.'),e}},r._registeredPropagators=new Map([["tracecontext",function(){return new Yt}],["baggage",function(){return new Qt}]]),r._registeredExporters=new Map,r}();import{ExportResultCode as Kt,hrTimeToMicroseconds as ut}from"/v135/@opentelemetry/core@1.17.0/denonext/core.mjs";var Wt=function(r){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&r[t],n=0;if(e)return e.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ar=function(){function r(){}return r.prototype.export=function(t,e){return this._sendSpans(t,e)},r.prototype.shutdown=function(){return this._sendSpans([]),this.forceFlush()},r.prototype.forceFlush=function(){return Promise.resolve()},r.prototype._exportInfo=function(t){var e;return{traceId:t.spanContext().traceId,parentId:t.parentSpanId,traceState:(e=t.spanContext().traceState)===null||e===void 0?void 0:e.serialize(),name:t.name,id:t.spanContext().spanId,kind:t.kind,timestamp:ut(t.startTime),duration:ut(t.duration),attributes:t.attributes,status:t.status,events:t.events,links:t.links}},r.prototype._sendSpans=function(t,e){var n,o;try{for(var i=Wt(t),a=i.next();!a.done;a=i.next()){var s=a.value;console.dir(this._exportInfo(s),{depth:3})}}catch(p){n={error:p}}finally{try{a&&!a.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}if(e)return e({code:Kt.SUCCESS})},r}();import{ExportResultCode as pt}from"/v135/@opentelemetry/core@1.17.0/denonext/core.mjs";var Zt=function(r,t){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var n=e.call(r),o,i=[],a;try{for(;(t===void 0||t-- >0)&&!(o=n.next()).done;)i.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(e=n.return)&&e.call(n)}finally{if(a)throw a.error}}return i},Jt=function(r,t,e){if(e||arguments.length===2)for(var n=0,o=t.length,i;n<o;n++)(i||!(n in t))&&(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return r.concat(i||Array.prototype.slice.call(t))},pr=function(){function r(){this._finishedSpans=[],this._stopped=!1}return r.prototype.export=function(t,e){var n;if(this._stopped)return e({code:pt.FAILED,error:new Error("Exporter has been stopped")});(n=this._finishedSpans).push.apply(n,Jt([],Zt(t),!1)),setTimeout(function(){return e({code:pt.SUCCESS})},0)},r.prototype.shutdown=function(){return this._stopped=!0,this._finishedSpans=[],this.forceFlush()},r.prototype.forceFlush=function(){return Promise.resolve()},r.prototype.reset=function(){this._finishedSpans=[]},r.prototype.getFinishedSpans=function(){return this._finishedSpans},r}();import{TraceFlags as ee}from"/v135/@opentelemetry/api@1.6.0/denonext/api.mjs";import{internal as re,ExportResultCode as ne,globalErrorHandler as F,BindOnceFuture as ie}from"/v135/@opentelemetry/core@1.17.0/denonext/core.mjs";var $t=function(r,t,e,n){function o(i){return i instanceof e?i:new e(function(a){a(i)})}return new(e||(e=Promise))(function(i,a){function s(f){try{u(n.next(f))}catch(c){a(c)}}function p(f){try{u(n.throw(f))}catch(c){a(c)}}function u(f){f.done?i(f.value):o(f.value).then(s,p)}u((n=n.apply(r,t||[])).next())})},te=function(r,t){var e={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,o,i,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(u){return function(f){return p([u,f])}}function p(u){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,o&&(i=u[0]&2?o.return:u[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,u[1])).done)return i;switch(o=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return e.label++,{value:u[1],done:!1};case 5:e.label++,o=u[1],u=[0];continue;case 7:u=e.ops.pop(),e.trys.pop();continue;default:if(i=e.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){e=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){e.label=u[1];break}if(u[0]===6&&e.label<i[1]){e.label=i[1],i=u;break}if(i&&e.label<i[2]){e.label=i[2],e.ops.push(u);break}i[2]&&e.ops.pop(),e.trys.pop();continue}u=t.call(r,e)}catch(f){u=[6,f],o=0}finally{n=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},dr=function(){function r(t){this._exporter=t,this._shutdownOnce=new ie(this._shutdown,this),this._unresolvedExports=new Set}return r.prototype.forceFlush=function(){return $t(this,void 0,void 0,function(){return te(this,function(t){switch(t.label){case 0:return[4,Promise.all(Array.from(this._unresolvedExports))];case 1:return t.sent(),this._exporter.forceFlush?[4,this._exporter.forceFlush()]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},r.prototype.onStart=function(t,e){},r.prototype.onEnd=function(t){var e=this,n,o;if(!this._shutdownOnce.isCalled&&t.spanContext().traceFlags&ee.SAMPLED){var i=function(){return re._export(e._exporter,[t]).then(function(s){var p;s.code!==ne.SUCCESS&&F((p=s.error)!==null&&p!==void 0?p:new Error("SimpleSpanProcessor: span export failed (status "+s+")"))}).catch(function(s){F(s)})};if(t.resource.asyncAttributesPending){var a=(o=(n=t.resource).waitForAsyncAttributes)===null||o===void 0?void 0:o.call(n).then(function(){return a!=null&&e._unresolvedExports.delete(a),i()},function(s){return F(s)});a!=null&&this._unresolvedExports.add(a)}else i()}},r.prototype.shutdown=function(){return this._shutdownOnce.call()},r.prototype._shutdown=function(){return this._exporter.shutdown()},r}();export{L as AlwaysOffSampler,v as AlwaysOnSampler,nr as BasicTracerProvider,tt as BatchSpanProcessor,ar as ConsoleSpanExporter,T as ForceFlushState,pr as InMemorySpanExporter,ot as NoopSpanProcessor,w as ParentBasedSampler,rt as RandomIdGenerator,m as SamplingDecision,dr as SimpleSpanProcessor,Q as Span,N as TraceIdRatioBasedSampler,nt as Tracer};
//# sourceMappingURL=sdk-trace-base.mjs.map