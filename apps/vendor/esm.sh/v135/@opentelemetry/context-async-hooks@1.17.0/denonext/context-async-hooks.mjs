/* esm.sh - esbuild bundle(@opentelemetry/context-async-hooks@1.17.0) denonext production */
import * as __0$ from "/v135/@opentelemetry/api@1.6.0/denonext/api.mjs";
import * as __1$ from "node:async_hooks";
import * as __2$ from "/v135/@opentelemetry/api@1.6.0/denonext/api.mjs";
import * as __3$ from "node:async_hooks";
import * as __4$ from "node:events";
var require=n=>{const e=m=>typeof m.default<"u"?m.default:m,c=m=>Object.assign({},m);switch(n){case"@opentelemetry/api":return c(__0$);case"async_hooks":return e(__1$);case"events":return e(__4$);default:throw new Error("module \""+n+"\" not found");}};
var S=Object.create;var g=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var j=Object.getPrototypeOf,q=Object.prototype.hasOwnProperty;var l=(n=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(n,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):n)(function(n){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+n+'" is not supported')});var d=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),T=(n,e)=>{for(var t in e)g(n,t,{get:e[t],enumerable:!0})},y=(n,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of R(e))!q.call(n,r)&&r!==t&&g(n,r,{get:()=>e[r],enumerable:!(s=w(e,r))||s.enumerable});return n},_=(n,e,t)=>(y(n,e,"default"),t&&y(t,e,"default")),O=(n,e,t)=>(t=n!=null?S(j(n)):{},y(e||!n||!n.__esModule?g(t,"default",{value:n,enumerable:!0}):t,n));var x=d(f=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0});f.AbstractAsyncHooksContextManager=void 0;var D=l("events"),W=["addListener","on","once","prependListener","prependOnceListener"],v=class{constructor(){this._kOtListeners=Symbol("OtListeners"),this._wrapped=!1}bind(e,t){return t instanceof D.EventEmitter?this._bindEventEmitter(e,t):typeof t=="function"?this._bindFunction(e,t):t}_bindFunction(e,t){let s=this,r=function(...i){return s.with(e,()=>t.apply(this,i))};return Object.defineProperty(r,"length",{enumerable:!1,configurable:!0,writable:!1,value:t.length}),r}_bindEventEmitter(e,t){return this._getPatchMap(t)!==void 0||(this._createPatchMap(t),W.forEach(r=>{t[r]!==void 0&&(t[r]=this._patchAddListener(t,t[r],e))}),typeof t.removeListener=="function"&&(t.removeListener=this._patchRemoveListener(t,t.removeListener)),typeof t.off=="function"&&(t.off=this._patchRemoveListener(t,t.off)),typeof t.removeAllListeners=="function"&&(t.removeAllListeners=this._patchRemoveAllListeners(t,t.removeAllListeners))),t}_patchRemoveListener(e,t){let s=this;return function(r,i){var c;let u=(c=s._getPatchMap(e))===null||c===void 0?void 0:c[r];if(u===void 0)return t.call(this,r,i);let h=u.get(i);return t.call(this,r,h||i)}}_patchRemoveAllListeners(e,t){let s=this;return function(r){let i=s._getPatchMap(e);return i!==void 0&&(arguments.length===0?s._createPatchMap(e):i[r]!==void 0&&delete i[r]),t.apply(this,arguments)}}_patchAddListener(e,t,s){let r=this;return function(i,c){if(r._wrapped)return t.call(this,i,c);let u=r._getPatchMap(e);u===void 0&&(u=r._createPatchMap(e));let h=u[i];h===void 0&&(h=new WeakMap,u[i]=h);let A=r.bind(s,c);h.set(c,A),r._wrapped=!0;try{return t.call(this,i,A)}finally{r._wrapped=!1}}}_createPatchMap(e){let t=Object.create(null);return e[this._kOtListeners]=t,t}_getPatchMap(e){return e[this._kOtListeners]}};f.AbstractAsyncHooksContextManager=v});var k=d(p=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0});p.AsyncHooksContextManager=void 0;var B=l("@opentelemetry/api"),F=l("async_hooks"),I=x(),L=class extends I.AbstractAsyncHooksContextManager{constructor(){super(),this._contexts=new Map,this._stack=[],this._asyncHook=F.createHook({init:this._init.bind(this),before:this._before.bind(this),after:this._after.bind(this),destroy:this._destroy.bind(this),promiseResolve:this._destroy.bind(this)})}active(){var e;return(e=this._stack[this._stack.length-1])!==null&&e!==void 0?e:B.ROOT_CONTEXT}with(e,t,s,...r){this._enterContext(e);try{return t.call(s,...r)}finally{this._exitContext()}}enable(){return this._asyncHook.enable(),this}disable(){return this._asyncHook.disable(),this._contexts.clear(),this._stack=[],this}_init(e,t){if(t==="TIMERWRAP")return;let s=this._stack[this._stack.length-1];s!==void 0&&this._contexts.set(e,s)}_destroy(e){this._contexts.delete(e)}_before(e){let t=this._contexts.get(e);t!==void 0&&this._enterContext(t)}_after(){this._exitContext()}_enterContext(e){this._stack.push(e)}_exitContext(){this._stack.pop()}};p.AsyncHooksContextManager=L});var C=d(b=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.AsyncLocalStorageContextManager=void 0;var X=l("@opentelemetry/api"),N=l("async_hooks"),z=x(),M=class extends z.AbstractAsyncHooksContextManager{constructor(){super(),this._asyncLocalStorage=new N.AsyncLocalStorage}active(){var e;return(e=this._asyncLocalStorage.getStore())!==null&&e!==void 0?e:X.ROOT_CONTEXT}with(e,t,s,...r){let i=s==null?t:t.bind(s);return this._asyncLocalStorage.run(e,i,...r)}enable(){return this}disable(){return this._asyncLocalStorage.disable(),this}};b.AsyncLocalStorageContextManager=M});var m=d(o=>{"use strict";var G=o&&o.__createBinding||(Object.create?function(n,e,t,s){s===void 0&&(s=t),Object.defineProperty(n,s,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,s){s===void 0&&(s=t),n[s]=e[t]}),P=o&&o.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&G(e,n,t)};Object.defineProperty(o,"__esModule",{value:!0});P(k(),o);P(C(),o)});var a={};T(a,{AsyncHooksContextManager:()=>Q,AsyncLocalStorageContextManager:()=>K,__esModule:()=>J,default:()=>V});var H=O(m());_(a,O(m()));var{__esModule:J,AsyncLocalStorageContextManager:K,AsyncHooksContextManager:Q}=H,{default:E,...U}=H,V=E!==void 0?E:U;export{Q as AsyncHooksContextManager,K as AsyncLocalStorageContextManager,J as __esModule,V as default};
//# sourceMappingURL=context-async-hooks.mjs.map