/* esm.sh - esbuild bundle(@opentelemetry/propagator-jaeger@1.17.0) denonext production */
import{propagation as h,trace as I,TraceFlags as E}from"/v135/@opentelemetry/api@1.6.0/denonext/api.mjs";import{isTracingSuppressed as j}from"/v135/@opentelemetry/core@1.17.0/denonext/core.mjs";var x=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,a=e&&r[e],t=0;if(a)return a.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&t>=r.length&&(r=void 0),{value:r&&r[t++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},B=function(r,e){var a=typeof Symbol=="function"&&r[Symbol.iterator];if(!a)return r;var t=a.call(r),n,o=[],i;try{for(;(e===void 0||e-- >0)&&!(n=t.next()).done;)o.push(n.value)}catch(l){i={error:l}}finally{try{n&&!n.done&&(a=t.return)&&a.call(t)}finally{if(i)throw i.error}}return o},S="uber-trace-id",H="uberctx",C=function(){function r(e){typeof e=="string"?(this._jaegerTraceHeader=e,this._jaegerBaggageHeaderPrefix=H):(this._jaegerTraceHeader=e?.customTraceHeader||S,this._jaegerBaggageHeaderPrefix=e?.customBaggageHeaderPrefix||H)}return r.prototype.inject=function(e,a,t){var n,o,i=I.getSpanContext(e),l=h.getBaggage(e);if(i&&j(e)===!1){var u="0"+(i.traceFlags||E.NONE).toString(16);t.set(a,this._jaegerTraceHeader,i.traceId+":"+i.spanId+":0:"+u)}if(l)try{for(var s=x(l.getAllEntries()),f=s.next();!f.done;f=s.next()){var d=B(f.value,2),y=d[0],g=d[1];t.set(a,this._jaegerBaggageHeaderPrefix+"-"+y,encodeURIComponent(g.value))}}catch(v){n={error:v}}finally{try{f&&!f.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}},r.prototype.extract=function(e,a,t){var n,o,i=this,l,u=t.get(a,this._jaegerTraceHeader),s=Array.isArray(u)?u[0]:u,f=t.keys(a).filter(function(p){return p.startsWith(i._jaegerBaggageHeaderPrefix+"-")}).map(function(p){var _=t.get(a,p);return{key:p.substring(i._jaegerBaggageHeaderPrefix.length+1),value:Array.isArray(_)?_[0]:_}}),d=e;if(typeof s=="string"){var y=A(s);y&&(d=I.setSpanContext(d,y))}if(f.length===0)return d;var g=(l=h.getBaggage(e))!==null&&l!==void 0?l:h.createBaggage();try{for(var v=x(f),c=v.next();!c.done;c=v.next()){var m=c.value;m.value!==void 0&&(g=g.setEntry(m.key,{value:decodeURIComponent(m.value)}))}}catch(p){n={error:p}}finally{try{c&&!c.done&&(o=v.return)&&o.call(v)}finally{if(n)throw n.error}}return d=h.setBaggage(d,g),d},r.prototype.fields=function(){return[this._jaegerTraceHeader]},r}();var T=/^[0-9a-f]{1,2}$/i;function A(r){var e=decodeURIComponent(r).split(":");if(e.length!==4)return null;var a=B(e,4),t=a[0],n=a[1],o=a[3],i=t.padStart(32,"0"),l=n.padStart(16,"0"),u=T.test(o)?parseInt(o,16)&1:1;return{traceId:i,spanId:l,isRemote:!0,traceFlags:u}}export{C as JaegerPropagator,H as UBER_BAGGAGE_HEADER_PREFIX,S as UBER_TRACE_ID_HEADER};
//# sourceMappingURL=propagator-jaeger.mjs.map