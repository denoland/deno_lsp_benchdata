/* esm.sh - esbuild bundle(@octokit/auth-oauth-user@4.0.1) denonext production */
import{getUserAgent as A}from"/v135/universal-user-agent@6.0.1/denonext/universal-user-agent.mjs";import{request as I}from"/v135/@octokit/request@8.1.6/denonext/request.mjs";var a="4.0.1";import{createOAuthDeviceAuth as d}from"/v135/@octokit/auth-oauth-device@6.0.1/denonext/auth-oauth-device.mjs";import{exchangeWebFlowCode as y}from"/v135/@octokit/oauth-methods@4.0.0/denonext/oauth-methods.mjs";async function h(e){if("code"in e.strategyOptions){let{authentication:t}=await y({clientId:e.clientId,clientSecret:e.clientSecret,clientType:e.clientType,onTokenCreated:e.onTokenCreated,...e.strategyOptions,request:e.request});return{type:"token",tokenType:"oauth",...t}}if("onVerification"in e.strategyOptions){let i=await d({clientType:e.clientType,clientId:e.clientId,onTokenCreated:e.onTokenCreated,...e.strategyOptions,request:e.request})({type:"oauth"});return{clientSecret:e.clientSecret,...i}}if("token"in e.strategyOptions)return{type:"token",tokenType:"oauth",clientId:e.clientId,clientSecret:e.clientSecret,clientType:e.clientType,onTokenCreated:e.onTokenCreated,...e.strategyOptions};throw new Error("[@octokit/auth-oauth-user] Invalid strategy options")}import{checkToken as k,deleteAuthorization as f,deleteToken as T,refreshToken as s,resetToken as m}from"/v135/@octokit/oauth-methods@4.0.0/denonext/oauth-methods.mjs";async function r(e,t={}){if(e.authentication||(e.authentication=e.clientType==="oauth-app"?await h(e):await h(e)),e.authentication.invalid)throw new Error("[@octokit/auth-oauth-user] Token is invalid");let i=e.authentication;if("expiresAt"in i&&(t.type==="refresh"||new Date(i.expiresAt)<new Date)){let{authentication:o}=await s({clientType:"github-app",clientId:e.clientId,clientSecret:e.clientSecret,refreshToken:i.refreshToken,request:e.request});e.authentication={tokenType:"oauth",type:"token",...o}}if(t.type==="refresh"){if(e.clientType==="oauth-app")throw new Error("[@octokit/auth-oauth-user] OAuth Apps do not support expiring tokens");if(!i.hasOwnProperty("expiresAt"))throw new Error("[@octokit/auth-oauth-user] Refresh token missing");await e.onTokenCreated?.(e.authentication,{type:t.type})}if(t.type==="check"||t.type==="reset"){let o=t.type==="check"?k:m;try{let{authentication:n}=await o({clientType:e.clientType,clientId:e.clientId,clientSecret:e.clientSecret,token:e.authentication.token,request:e.request});return e.authentication={tokenType:"oauth",type:"token",...n},t.type==="reset"&&await e.onTokenCreated?.(e.authentication,{type:t.type}),e.authentication}catch(n){throw n.status===404&&(n.message="[@octokit/auth-oauth-user] Token is invalid",e.authentication.invalid=!0),n}}if(t.type==="delete"||t.type==="deleteAuthorization"){let o=t.type==="delete"?T:f;try{await o({clientType:e.clientType,clientId:e.clientId,clientSecret:e.clientSecret,token:e.authentication.token,request:e.request})}catch(n){if(n.status!==404)throw n}return e.authentication.invalid=!0,e.authentication}return e.authentication}import g from"/v135/btoa-lite@1.0.0/denonext/btoa-lite.mjs";var w=/\/applications\/[^/]+\/(token|grant)s?/;function p(e){return e&&w.test(e)}async function l(e,t,i,o={}){let n=t.endpoint.merge(i,o);if(/\/login\/(oauth\/access_token|device\/code)$/.test(n.url))return t(n);if(p(n.url)){let c=g(`${e.clientId}:${e.clientSecret}`);return n.headers.authorization=`basic ${c}`,t(n)}let{token:u}=e.clientType==="oauth-app"?await r({...e,request:t}):await r({...e,request:t});return n.headers.authorization="token "+u,t(n)}function S({clientId:e,clientSecret:t,clientType:i="oauth-app",request:o=I.defaults({headers:{"user-agent":`octokit-auth-oauth-app.js/${a} ${A()}`}}),onTokenCreated:n,...u}){let c=Object.assign({clientType:i,clientId:e,clientSecret:t,onTokenCreated:n,strategyOptions:u,request:o});return Object.assign(r.bind(null,c),{hook:l.bind(null,c)})}S.VERSION=a;export{S as createOAuthUserAuth,p as requiresBasicAuth};
//# sourceMappingURL=auth-oauth-user.mjs.map