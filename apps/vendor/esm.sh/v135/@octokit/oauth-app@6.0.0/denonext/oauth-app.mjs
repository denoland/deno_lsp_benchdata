/* esm.sh - esbuild bundle(@octokit/oauth-app@6.0.0) denonext production */
import { Buffer as __Buffer$ } from "node:buffer";
import * as __0$ from "/v135/@octokit/auth-oauth-app@7.0.1/denonext/auth-oauth-app.mjs";
import * as __1$ from "/v135/@octokit/core@5.0.2/denonext/core.mjs";
import * as __2$ from "/v135/universal-user-agent@6.0.1/denonext/universal-user-agent.mjs";
import * as __3$ from "/v135/@octokit/auth-oauth-user@4.0.1/denonext/auth-oauth-user.mjs";
import * as __4$ from "/v135/@octokit/oauth-methods@4.0.0/denonext/oauth-methods.mjs";
import * as __5$ from "/v135/@octokit/auth-unauthenticated@5.0.1/denonext/auth-unauthenticated.mjs";
var require=n=>{const e=m=>typeof m.default<"u"?m.default:m,c=m=>Object.assign({},m);switch(n){case"@octokit/auth-oauth-app":return e(__0$);case"@octokit/core":return e(__1$);case"universal-user-agent":return c(__2$);case"@octokit/auth-oauth-user":return e(__3$);case"@octokit/oauth-methods":return e(__4$);case"@octokit/auth-unauthenticated":return e(__5$);default:throw new Error("module \""+n+"\" not found");}};
var M=Object.create;var O=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var D=Object.getPrototypeOf,J=Object.prototype.hasOwnProperty;var c=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(n,t)=>(typeof require<"u"?require:n)[t]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var L=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports),G=(e,n)=>{for(var t in n)O(e,t,{get:n[t],enumerable:!0})},A=(e,n,t,o)=>{if(n&&typeof n=="object"||typeof n=="function")for(let r of C(n))!J.call(e,r)&&r!==t&&O(e,r,{get:()=>n[r],enumerable:!(o=$(n,r))||o.enumerable});return e},w=(e,n,t)=>(A(e,n,"default"),t&&A(t,n,"default")),v=(e,n,t)=>(t=e!=null?M(D(e)):{},A(n||!e||!e.__esModule?O(t,"default",{value:e,enumerable:!0}):t,e));var b=L(($e,H)=>{"use strict";var V=Object.create,T=Object.defineProperty,F=Object.getOwnPropertyDescriptor,Q=Object.getOwnPropertyNames,B=Object.getPrototypeOf,Y=Object.prototype.hasOwnProperty,K=(e,n)=>{for(var t in n)T(e,t,{get:n[t],enumerable:!0})},W=(e,n,t,o)=>{if(n&&typeof n=="object"||typeof n=="function")for(let r of Q(n))!Y.call(e,r)&&r!==t&&T(e,r,{get:()=>n[r],enumerable:!(o=F(n,r))||o.enumerable});return e},k=(e,n,t)=>(t=e!=null?V(B(e)):{},W(n||!e||!e.__esModule?T(t,"default",{value:e,enumerable:!0}):t,e)),X=e=>W(T({},"__esModule",{value:!0}),e),E={};K(E,{OAuthApp:()=>xe,createAWSLambdaAPIGatewayV2Handler:()=>Ie,createNodeMiddleware:()=>Oe,createWebWorkerHandler:()=>_e,handleRequest:()=>g,sendNodeResponse:()=>z,unknownRouteResponse:()=>R});H.exports=X(E);var Z=c("@octokit/auth-oauth-app"),U="6.0.0";function j(e,n,t){if(Array.isArray(n)){for(let o of n)j(e,o,t);return}e.eventHandlers[n]||(e.eventHandlers[n]=[]),e.eventHandlers[n].push(t)}var ee=c("@octokit/core"),te=c("universal-user-agent"),ne=ee.Octokit.defaults({userAgent:`octokit-oauth-app.js/${U} ${(0,te.getUserAgent)()}`}),oe=c("@octokit/auth-oauth-user");async function l(e,n){let{name:t,action:o}=n;if(e.eventHandlers[`${t}.${o}`])for(let r of e.eventHandlers[`${t}.${o}`])await r(n);if(e.eventHandlers[t])for(let r of e.eventHandlers[t])await r(n)}async function re(e,n){return e.octokit.auth({type:"oauth-user",...n,async factory(t){let o=new e.Octokit({authStrategy:oe.createOAuthUserAuth,auth:t}),r=await o.auth({type:"get"});return await l(e,{name:"token",action:"created",token:r.token,scopes:r.scopes,authentication:r,octokit:o}),o}})}var ie=k(c("@octokit/oauth-methods"));function ae(e,n){let t={clientId:e.clientId,request:e.octokit.request,...n,allowSignup:e.allowSignup??n.allowSignup,redirectUrl:n.redirectUrl??e.redirectUrl,scopes:n.scopes??e.defaultScopes};return ie.getWebFlowAuthorizationUrl({clientType:e.clientType,...t})}var ce=k(c("@octokit/auth-oauth-app"));async function se(e,n){let t=await e.octokit.auth({type:"oauth-user",...n});return await l(e,{name:"token",action:"created",token:t.token,scopes:t.scopes,authentication:t,octokit:new e.Octokit({authStrategy:ce.createOAuthUserAuth,auth:{clientType:e.clientType,clientId:e.clientId,clientSecret:e.clientSecret,token:t.token,scopes:t.scopes,refreshToken:t.refreshToken,expiresAt:t.expiresAt,refreshTokenExpiresAt:t.refreshTokenExpiresAt}})}),{authentication:t}}var ue=k(c("@octokit/oauth-methods"));async function he(e,n){let t=await ue.checkToken({clientType:e.clientType,clientId:e.clientId,clientSecret:e.clientSecret,request:e.octokit.request,...n});return Object.assign(t.authentication,{type:"token",tokenType:"oauth"}),t}var _=k(c("@octokit/oauth-methods")),m=c("@octokit/auth-oauth-user");async function le(e,n){let t={clientId:e.clientId,clientSecret:e.clientSecret,request:e.octokit.request,...n};if(e.clientType==="oauth-app"){let i=await _.resetToken({clientType:"oauth-app",...t}),h=Object.assign(i.authentication,{type:"token",tokenType:"oauth"});return await l(e,{name:"token",action:"reset",token:i.authentication.token,scopes:i.authentication.scopes||void 0,authentication:h,octokit:new e.Octokit({authStrategy:m.createOAuthUserAuth,auth:{clientType:e.clientType,clientId:e.clientId,clientSecret:e.clientSecret,token:i.authentication.token,scopes:i.authentication.scopes}})}),{...i,authentication:h}}let o=await _.resetToken({clientType:"github-app",...t}),r=Object.assign(o.authentication,{type:"token",tokenType:"oauth"});return await l(e,{name:"token",action:"reset",token:o.authentication.token,authentication:r,octokit:new e.Octokit({authStrategy:m.createOAuthUserAuth,auth:{clientType:e.clientType,clientId:e.clientId,clientSecret:e.clientSecret,token:o.authentication.token}})}),{...o,authentication:r}}var pe=k(c("@octokit/oauth-methods")),de=c("@octokit/auth-oauth-user");async function ke(e,n){if(e.clientType==="oauth-app")throw new Error("[@octokit/oauth-app] app.refreshToken() is not supported for OAuth Apps");let t=await pe.refreshToken({clientType:"github-app",clientId:e.clientId,clientSecret:e.clientSecret,request:e.octokit.request,refreshToken:n.refreshToken}),o=Object.assign(t.authentication,{type:"token",tokenType:"oauth"});return await l(e,{name:"token",action:"refreshed",token:t.authentication.token,authentication:o,octokit:new e.Octokit({authStrategy:de.createOAuthUserAuth,auth:{clientType:e.clientType,clientId:e.clientId,clientSecret:e.clientSecret,token:t.authentication.token}})}),{...t,authentication:o}}var fe=k(c("@octokit/oauth-methods")),we=c("@octokit/auth-oauth-user");async function ye(e,n){if(e.clientType==="oauth-app")throw new Error("[@octokit/oauth-app] app.scopeToken() is not supported for OAuth Apps");let t=await fe.scopeToken({clientType:"github-app",clientId:e.clientId,clientSecret:e.clientSecret,request:e.octokit.request,...n}),o=Object.assign(t.authentication,{type:"token",tokenType:"oauth"});return await l(e,{name:"token",action:"scoped",token:t.authentication.token,authentication:o,octokit:new e.Octokit({authStrategy:we.createOAuthUserAuth,auth:{clientType:e.clientType,clientId:e.clientId,clientSecret:e.clientSecret,token:t.authentication.token}})}),{...t,authentication:o}}var q=k(c("@octokit/oauth-methods")),Te=c("@octokit/auth-unauthenticated");async function ge(e,n){let t={clientId:e.clientId,clientSecret:e.clientSecret,request:e.octokit.request,...n},o=e.clientType==="oauth-app"?await q.deleteToken({clientType:"oauth-app",...t}):await q.deleteToken({clientType:"github-app",...t});return await l(e,{name:"token",action:"deleted",token:n.token,octokit:new e.Octokit({authStrategy:Te.createUnauthenticatedAuth,auth:{reason:'Handling "token.deleted" event. The access for the token has been revoked.'}})}),o}var I=k(c("@octokit/oauth-methods")),x=c("@octokit/auth-unauthenticated");async function Se(e,n){let t={clientId:e.clientId,clientSecret:e.clientSecret,request:e.octokit.request,...n},o=e.clientType==="oauth-app"?await I.deleteAuthorization({clientType:"oauth-app",...t}):await I.deleteAuthorization({clientType:"github-app",...t});return await l(e,{name:"token",action:"deleted",token:n.token,octokit:new e.Octokit({authStrategy:x.createUnauthenticatedAuth,auth:{reason:'Handling "token.deleted" event. The access for the token has been revoked.'}})}),await l(e,{name:"authorization",action:"deleted",token:n.token,octokit:new e.Octokit({authStrategy:x.createUnauthenticatedAuth,auth:{reason:'Handling "authorization.deleted" event. The access for the app has been revoked.'}})}),o}function R(e){return{status:404,headers:{"content-type":"application/json"},text:JSON.stringify({error:`Unknown route: ${e.method} ${e.url}`})}}async function g(e,{pathPrefix:n="/api/github/oauth"},t){if(t.method==="OPTIONS")return{status:200,headers:{"access-control-allow-origin":"*","access-control-allow-methods":"*","access-control-allow-headers":"Content-Type, User-Agent, Authorization"}};let{pathname:o}=new URL(t.url,"http://localhost");if(!o.startsWith(`${n}/`))return;o=o.slice(n.length+1);let r=[t.method,o].join(" "),i={getLogin:"GET login",getCallback:"GET callback",createToken:"POST token",getToken:"GET token",patchToken:"PATCH token",patchRefreshToken:"PATCH refresh-token",scopeToken:"POST token/scoped",deleteToken:"DELETE token",deleteGrant:"DELETE grant"};if(!Object.values(i).includes(r))return R(t);let h;try{let d=await t.text();h=d?JSON.parse(d):{}}catch{return{status:400,headers:{"content-type":"application/json","access-control-allow-origin":"*"},text:JSON.stringify({error:"[@octokit/oauth-app] request error"})}}let{searchParams:S}=new URL(t.url,"http://localhost"),s=Object.fromEntries(S),p=t.headers;try{if(r===i.getLogin){let{url:a}=e.getWebFlowAuthorizationUrl({state:s.state,scopes:s.scopes?s.scopes.split(","):void 0,allowSignup:s.allowSignup?s.allowSignup==="true":void 0,redirectUrl:s.redirectUrl});return{status:302,headers:{location:a}}}if(r===i.getCallback){if(s.error)throw new Error(`[@octokit/oauth-app] ${s.error} ${s.error_description}`);if(!s.code)throw new Error('[@octokit/oauth-app] "code" parameter is required');let{authentication:{token:a}}=await e.createToken({code:s.code});return{status:200,headers:{"content-type":"text/html"},text:`<h1>Token created successfully</h1>

<p>Your token is: <strong>${a}</strong>. Copy it now as it cannot be shown again.</p>`}}if(r===i.createToken){let{code:a,redirectUrl:u}=h;if(!a)throw new Error('[@octokit/oauth-app] "code" parameter is required');let y=await e.createToken({code:a,redirectUrl:u});return delete y.authentication.clientSecret,{status:201,headers:{"content-type":"application/json","access-control-allow-origin":"*"},text:JSON.stringify(y)}}if(r===i.getToken){let a=p.authorization?.substr(6);if(!a)throw new Error('[@octokit/oauth-app] "Authorization" header is required');let u=await e.checkToken({token:a});return delete u.authentication.clientSecret,{status:200,headers:{"content-type":"application/json","access-control-allow-origin":"*"},text:JSON.stringify(u)}}if(r===i.patchToken){let a=p.authorization?.substr(6);if(!a)throw new Error('[@octokit/oauth-app] "Authorization" header is required');let u=await e.resetToken({token:a});return delete u.authentication.clientSecret,{status:200,headers:{"content-type":"application/json","access-control-allow-origin":"*"},text:JSON.stringify(u)}}if(r===i.patchRefreshToken){if(!p.authorization?.substr(6))throw new Error('[@octokit/oauth-app] "Authorization" header is required');let{refreshToken:u}=h;if(!u)throw new Error("[@octokit/oauth-app] refreshToken must be sent in request body");let y=await e.refreshToken({refreshToken:u});return delete y.authentication.clientSecret,{status:200,headers:{"content-type":"application/json","access-control-allow-origin":"*"},text:JSON.stringify(y)}}if(r===i.scopeToken){let a=p.authorization?.substr(6);if(!a)throw new Error('[@octokit/oauth-app] "Authorization" header is required');let u=await e.scopeToken({token:a,...h});return delete u.authentication.clientSecret,{status:200,headers:{"content-type":"application/json","access-control-allow-origin":"*"},text:JSON.stringify(u)}}if(r===i.deleteToken){let a=p.authorization?.substr(6);if(!a)throw new Error('[@octokit/oauth-app] "Authorization" header is required');return await e.deleteToken({token:a}),{status:204,headers:{"access-control-allow-origin":"*"}}}let d=p.authorization?.substr(6);if(!d)throw new Error('[@octokit/oauth-app] "Authorization" header is required');return await e.deleteAuthorization({token:d}),{status:204,headers:{"access-control-allow-origin":"*"}}}catch(d){return{status:400,headers:{"content-type":"application/json","access-control-allow-origin":"*"},text:JSON.stringify({error:d.message})}}}function Ae(e){let{method:n,url:t,headers:o}=e;async function r(){return await new Promise((h,S)=>{let s=[];e.on("error",S).on("data",p=>s.push(p)).on("end",()=>h(__Buffer$.concat(s).toString()))})}return{method:n,url:t,headers:o,text:r}}function z(e,n){n.writeHead(e.status,e.headers),n.end(e.text)}function Oe(e,n={}){return async function(t,o,r){let i=await Ae(t),h=await g(e,n,i);return h?(z(h,o),!0):(r?.(),!1)}}function be(e){let n=Object.fromEntries(e.headers.entries());return{method:e.method,url:e.url,headers:n,text:()=>e.text()}}function ve(e){return new Response(e.text,{status:e.status,headers:e.headers})}function _e(e,n={}){return async function(t){let o=await be(t),r=await g(e,n,o);return r?ve(r):void 0}}function me(e){let{method:n}=e.requestContext.http,t=e.rawPath,{stage:o}=e.requestContext;t.startsWith("/"+o)&&(t=t.substring(o.length+1)),e.rawQueryString&&(t+="?"+e.rawQueryString);let r=e.headers;return{method:n,url:t,headers:r,text:async()=>e.body||""}}function qe(e){return{statusCode:e.status,headers:e.headers,body:e.text}}function Ie(e,n={}){return async function(t){let o=me(t),r=await g(e,n,o);return r?qe(r):void 0}}var xe=class{static{this.VERSION=U}static defaults(e){return class extends this{constructor(...t){super({...e,...t[0]})}}}constructor(e){let n=e.Octokit||ne;this.type=e.clientType||"oauth-app";let t=new n({authStrategy:Z.createOAuthAppAuth,auth:{clientType:this.type,clientId:e.clientId,clientSecret:e.clientSecret}}),o={clientType:this.type,clientId:e.clientId,clientSecret:e.clientSecret,defaultScopes:e.defaultScopes||[],allowSignup:e.allowSignup,baseUrl:e.baseUrl,redirectUrl:e.redirectUrl,log:e.log,Octokit:n,octokit:t,eventHandlers:{}};this.on=j.bind(null,o),this.octokit=t,this.getUserOctokit=re.bind(null,o),this.getWebFlowAuthorizationUrl=ae.bind(null,o),this.createToken=se.bind(null,o),this.checkToken=he.bind(null,o),this.resetToken=le.bind(null,o),this.refreshToken=ke.bind(null,o),this.scopeToken=ye.bind(null,o),this.deleteToken=ge.bind(null,o),this.deleteAuthorization=Se.bind(null,o)}}});var f={};G(f,{OAuthApp:()=>We,createAWSLambdaAPIGatewayV2Handler:()=>Ee,createNodeMiddleware:()=>Ue,createWebWorkerHandler:()=>je,default:()=>Ne,handleRequest:()=>Re,sendNodeResponse:()=>ze,unknownRouteResponse:()=>He});var N=v(b());w(f,v(b()));var{OAuthApp:We,createAWSLambdaAPIGatewayV2Handler:Ee,createNodeMiddleware:Ue,createWebWorkerHandler:je,handleRequest:Re,sendNodeResponse:ze,unknownRouteResponse:He}=N,{default:P,...Pe}=N,Ne=P!==void 0?P:Pe;export{We as OAuthApp,Ee as createAWSLambdaAPIGatewayV2Handler,Ue as createNodeMiddleware,je as createWebWorkerHandler,Ne as default,Re as handleRequest,ze as sendNodeResponse,He as unknownRouteResponse};
//# sourceMappingURL=oauth-app.mjs.map