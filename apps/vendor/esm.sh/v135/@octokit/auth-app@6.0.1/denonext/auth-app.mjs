/* esm.sh - esbuild bundle(@octokit/auth-app@6.0.1) denonext production */
import * as __0$ from "/v135/universal-user-agent@6.0.1/denonext/universal-user-agent.mjs";
import * as __1$ from "/v135/@octokit/request@8.1.6/denonext/request.mjs";
import * as __2$ from "/v135/@octokit/auth-oauth-app@7.0.1/denonext/auth-oauth-app.mjs";
import * as __3$ from "/v135/deprecation@2.3.1/denonext/deprecation.mjs";
import * as __4$ from "/v135/universal-github-app-jwt@1.1.1/denonext/universal-github-app-jwt.mjs";
import * as __5$ from "/v135/lru-cache@10.0.3/denonext/lru-cache.mjs";
import * as __6$ from "/v135/@octokit/auth-oauth-user@4.0.1/denonext/auth-oauth-user.mjs";
import * as __7$ from "/v135/@octokit/request-error@5.0.1/denonext/request-error.mjs";
var require=n=>{const e=m=>typeof m.default<"u"?m.default:m,c=m=>Object.assign({},m);switch(n){case"universal-user-agent":return c(__0$);case"@octokit/request":return e(__1$);case"@octokit/auth-oauth-app":return e(__2$);case"deprecation":return c(__3$);case"universal-github-app-jwt":return c(__4$);case"lru-cache":return c(__5$);case"@octokit/auth-oauth-user":return e(__6$);case"@octokit/request-error":return e(__7$);default:throw new Error("module \""+n+"\" not found");}};
var V=Object.create;var b=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var H=Object.getOwnPropertyNames;var J=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty;var u=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var Y=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),X=(e,t)=>{for(var r in t)b(e,r,{get:t[r],enumerable:!0})},k=(e,t,r,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of H(t))!L.call(e,i)&&i!==r&&b(e,i,{get:()=>t[i],enumerable:!(a=W(t,i))||a.enumerable});return e},y=(e,t,r)=>(k(e,t,"default"),r&&k(r,t,"default")),N=(e,t,r)=>(r=e!=null?V(J(e)):{},k(t||!e||!e.__esModule?b(r,"default",{value:e,enumerable:!0}):r,e));var v=Y((Te,F)=>{"use strict";var Q=Object.create,w=Object.defineProperty,Z=Object.getOwnPropertyDescriptor,ee=Object.getOwnPropertyNames,te=Object.getPrototypeOf,re=Object.prototype.hasOwnProperty,ie=(e,t)=>{for(var r in t)w(e,r,{get:t[r],enumerable:!0})},P=(e,t,r,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of ee(t))!re.call(e,i)&&i!==r&&w(e,i,{get:()=>t[i],enumerable:!(a=Z(t,i))||a.enumerable});return e},ae=(e,t,r)=>(r=e!=null?Q(te(e)):{},P(t||!e||!e.__esModule?w(r,"default",{value:e,enumerable:!0}):r,e)),ne=e=>P(w({},"__esModule",{value:!0}),e),q={};ie(q,{createAppAuth:()=>Oe,createOAuthUserAuth:()=>Se.createOAuthUserAuth});F.exports=ne(q);var oe=u("universal-user-agent"),se=u("@octokit/request"),pe=u("@octokit/auth-oauth-app"),ce=u("deprecation"),Pe=ae(u("@octokit/auth-oauth-app")),ue=u("universal-github-app-jwt");async function f({appId:e,privateKey:t,timeDifference:r}){try{let a=await(0,ue.githubAppJwt)({id:+e,privateKey:t,now:r&&Math.floor(Date.now()/1e3)+r});return{type:"app",token:a.token,appId:a.appId,expiresAt:new Date(a.expiration*1e3).toISOString()}}catch(a){throw t==="-----BEGIN RSA PRIVATE KEY-----"?new Error("The 'privateKey` option contains only the first line '-----BEGIN RSA PRIVATE KEY-----'. If you are setting it using a `.env` file, make sure it is set on a single line with newlines replaced by '\n'"):a}}var le=u("lru-cache");function he(){return new le.LRUCache({max:15e3,ttl:1e3*60*59})}async function de(e,t){let r=T(t),a=await e.get(r);if(!a)return;let[i,o,n,s,p,l]=a.split("|"),c=t.permissions||p.split(/,/).reduce((h,d)=>(/!$/.test(d)?h[d.slice(0,-1)]="write":h[d]="read",h),{});return{token:i,createdAt:o,expiresAt:n,permissions:c,repositoryIds:t.repositoryIds,repositoryNames:t.repositoryNames,singleFileName:l,repositorySelection:s}}async function me(e,t,r){let a=T(t),i=t.permissions?"":Object.keys(r.permissions).map(n=>`${n}${r.permissions[n]==="write"?"!":""}`).join(","),o=[r.token,r.createdAt,r.expiresAt,r.repositorySelection,i,r.singleFileName].join("|");await e.set(a,o)}function T({installationId:e,permissions:t={},repositoryIds:r=[],repositoryNames:a=[]}){let i=Object.keys(t).sort().map(s=>t[s]==="read"?s:`${s}!`).join(","),o=r.sort().join(","),n=a.join(",");return[e,o,n,i].filter(Boolean).join("|")}function $({installationId:e,token:t,createdAt:r,expiresAt:a,repositorySelection:i,permissions:o,repositoryIds:n,repositoryNames:s,singleFileName:p}){return Object.assign({type:"token",tokenType:"installation",token:t,installationId:e,permissions:o,createdAt:r,expiresAt:a,repositorySelection:i},n?{repositoryIds:n}:null,s?{repositoryNames:s}:null,p?{singleFileName:p}:null)}async function D(e,t,r){let a=Number(t.installationId||e.installationId);if(!a)throw new Error("[@octokit/auth-app] installationId option is required for installation authentication.");if(t.factory){let{type:_,factory:g,oauthApp:E,...A}={...e,...t};return g(A)}let i=Object.assign({installationId:a},t);if(!t.refresh){let _=await de(e.cache,i);if(_){let{token:g,createdAt:E,expiresAt:A,permissions:z,repositoryIds:C,repositoryNames:K,singleFileName:B,repositorySelection:G}=_;return $({installationId:a,token:g,createdAt:E,expiresAt:A,permissions:z,repositorySelection:G,repositoryIds:C,repositoryNames:K,singleFileName:B})}}let o=await f(e),n=r||e.request,{data:{token:s,expires_at:p,repositories:l,permissions:c,repository_selection:h,single_file:d}}=await n("POST /app/installations/{installation_id}/access_tokens",{installation_id:a,repository_ids:t.repositoryIds,repositories:t.repositoryNames,permissions:t.permissions,mediaType:{previews:["machine-man"]},headers:{authorization:`bearer ${o.token}`}}),I=c||{},S=h||"all",O=l?l.map(_=>_.id):void 0,j=l?l.map(_=>_.name):void 0,x=new Date().toISOString();return await me(e.cache,i,{token:s,createdAt:x,expiresAt:p,repositorySelection:S,permissions:I,repositoryIds:O,repositoryNames:j,singleFileName:d}),$({installationId:a,token:s,createdAt:x,expiresAt:p,repositorySelection:S,permissions:I,repositoryIds:O,repositoryNames:j,singleFileName:d})}async function _e(e,t){switch(t.type){case"app":return f(e);case"oauth":e.log.warn(new ce.Deprecation('[@octokit/auth-app] {type: "oauth"} is deprecated. Use {type: "oauth-app"} instead'));case"oauth-app":return e.oauthApp({type:"oauth-app"});case"installation":return D(e,{...t,type:"installation"});case"oauth-user":return e.oauthApp(t);default:throw new Error(`Invalid auth type: ${t.type}`)}}var ye=u("@octokit/auth-oauth-user"),qe=u("@octokit/request-error"),fe=["/app","/app/hook/config","/app/hook/deliveries","/app/hook/deliveries/{delivery_id}","/app/hook/deliveries/{delivery_id}/attempts","/app/installations","/app/installations/{installation_id}","/app/installations/{installation_id}/access_tokens","/app/installations/{installation_id}/suspended","/marketplace_listing/accounts/{account_id}","/marketplace_listing/plan","/marketplace_listing/plans","/marketplace_listing/plans/{plan_id}/accounts","/marketplace_listing/stubbed/accounts/{account_id}","/marketplace_listing/stubbed/plan","/marketplace_listing/stubbed/plans","/marketplace_listing/stubbed/plans/{plan_id}/accounts","/orgs/{org}/installation","/repos/{owner}/{repo}/installation","/users/{username}/installation"];function we(e){let r=`^(?:${e.map(a=>a.split("/").map(i=>i.startsWith("{")?"(?:.+?)":i).join("/")).map(a=>`(?:${a})`).join("|")})$`;return new RegExp(r,"i")}var ge=we(fe);function Ae(e){return!!e&&ge.test(e.split("?")[0])}var ke=5*1e3;function be(e){return!(e.message.match(/'Expiration time' claim \('exp'\) must be a numeric value representing the future time at which the assertion expires/)||e.message.match(/'Issued at' claim \('iat'\) must be an Integer representing the time that the assertion was issued/))}async function ve(e,t,r,a){let i=t.endpoint.merge(r,a),o=i.url;if(/\/login\/oauth\/access_token$/.test(o))return t(i);if(Ae(o.replace(t.endpoint.DEFAULTS.baseUrl,""))){let{token:p}=await f(e);i.headers.authorization=`bearer ${p}`;let l;try{l=await t(i)}catch(c){if(be(c)||typeof c.response.headers.date>"u")throw c;let h=Math.floor((Date.parse(c.response.headers.date)-Date.parse(new Date().toString()))/1e3);e.log.warn(c.message),e.log.warn(`[@octokit/auth-app] GitHub API time and system time are different by ${h} seconds. Retrying request with the difference accounted for.`);let{token:d}=await f({...e,timeDifference:h});return i.headers.authorization=`bearer ${d}`,t(i)}return l}if((0,ye.requiresBasicAuth)(o)){let p=await e.oauthApp({type:"oauth-app"});return i.headers.authorization=p.headers.authorization,t(i)}let{token:n,createdAt:s}=await D(e,{},t);return i.headers.authorization=`token ${n}`,R(e,t,i,s)}async function R(e,t,r,a,i=0){let o=+new Date-+new Date(a);try{return await t(r)}catch(n){if(n.status!==401)throw n;if(o>=ke)throw i>0&&(n.message=`After ${i} retries within ${o/1e3}s of creating the installation access token, the response remains 401. At this point, the cause may be an authentication problem or a system outage. Please check https://www.githubstatus.com for status information`),n;++i;let s=i*1e3;return e.log.warn(`[@octokit/auth-app] Retrying after 401 response to account for token replication delay (retry: ${i}, wait: ${s/1e3}s)`),await new Promise(p=>setTimeout(p,s)),R(e,t,r,a,i)}}var Ie="6.0.1",Se=u("@octokit/auth-oauth-user");function Oe(e){if(!e.appId)throw new Error("[@octokit/auth-app] appId option is required");if(!Number.isFinite(+e.appId))throw new Error("[@octokit/auth-app] appId option must be a number or numeric string");if(!e.privateKey)throw new Error("[@octokit/auth-app] privateKey option is required");if("installationId"in e&&!e.installationId)throw new Error("[@octokit/auth-app] installationId is set to a falsy value");let t=Object.assign({warn:console.warn.bind(console)},e.log),r=e.request||se.request.defaults({headers:{"user-agent":`octokit-auth-app.js/${Ie} ${(0,oe.getUserAgent)()}`}}),a=Object.assign({request:r,cache:he()},e,e.installationId?{installationId:Number(e.installationId)}:{},{log:t,oauthApp:(0,pe.createOAuthAppAuth)({clientType:"github-app",clientId:e.clientId||"",clientSecret:e.clientSecret||"",request:r})});return Object.assign(_e.bind(null,a),{hook:ve.bind(null,a)})}});var m={};X(m,{createAppAuth:()=>je,createOAuthUserAuth:()=>xe,default:()=>Ne});var M=N(v());y(m,N(v()));var{createAppAuth:je,createOAuthUserAuth:xe}=M,{default:U,...Ee}=M,Ne=U!==void 0?U:Ee;export{je as createAppAuth,xe as createOAuthUserAuth,Ne as default};
//# sourceMappingURL=auth-app.mjs.map