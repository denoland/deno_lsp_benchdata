/* esm.sh - esbuild bundle(aws4@1.12.0) denonext production */
import __Process$ from "node:process";
import { Buffer as __Buffer$ } from "node:buffer";
import * as __0$ from "node:url";
import * as __1$ from "node:querystring";
import * as __2$ from "node:crypto";
var require=n=>{const e=m=>typeof m.default<"u"?m.default:m,c=m=>Object.assign({},m);switch(n){case"url":return e(__0$);case"querystring":return e(__1$);case"crypto":return e(__2$);default:throw new Error("module \""+n+"\" not found");}};
var X=Object.create;var S=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var K=Object.getPrototypeOf,W=Object.prototype.hasOwnProperty;var A=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,i)=>(typeof require<"u"?require:t)[i]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var H=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),k=(e,t)=>{for(var i in t)S(e,i,{get:t[i],enumerable:!0})},v=(e,t,i,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of L(t))!W.call(e,o)&&o!==i&&S(e,o,{get:()=>t[o],enumerable:!(r=j(t,o))||r.enumerable});return e},c=(e,t,i)=>(v(e,t,"default"),i&&v(i,t,"default")),T=(e,t,i)=>(i=e!=null?X(K(e)):{},v(t||!e||!e.__esModule?S(i,"default",{value:e,enumerable:!0}):i,e));var D=H((V,z)=>{z.exports=function(e){return new d(e)};function d(e){this.capacity=e|0,this.map=Object.create(null),this.list=new m}d.prototype.get=function(e){var t=this.map[e];if(t!=null)return this.used(t),t.val};d.prototype.set=function(e,t){var i=this.map[e];if(i!=null)i.val=t;else{if(this.capacity||this.prune(),!this.capacity)return!1;i=new G(e,t),this.map[e]=i,this.capacity--}return this.used(i),!0};d.prototype.used=function(e){this.list.moveToFront(e)};d.prototype.prune=function(){var e=this.list.pop();e!=null&&(delete this.map[e.key],this.capacity++)};function m(){this.firstNode=null,this.lastNode=null}m.prototype.moveToFront=function(e){this.firstNode!=e&&(this.remove(e),this.firstNode==null?(this.firstNode=e,this.lastNode=e,e.prev=null,e.next=null):(e.prev=null,e.next=this.firstNode,e.next.prev=e,this.firstNode=e))};m.prototype.pop=function(){var e=this.lastNode;return e!=null&&this.remove(e),e};m.prototype.remove=function(e){this.firstNode==e?this.firstNode=e.next:e.prev!=null&&(e.prev.next=e.next),this.lastNode==e?this.lastNode=e.prev:e.next!=null&&(e.next.prev=e.prev)};function G(e,t){this.key=e,this.val=t,this.prev=null,this.next=null}});var x=H(q=>{var I=q,U=A("url"),_=A("querystring"),N=A("crypto"),Y=D(),E=Y(1e3);function f(e,t,i){return N.createHmac("sha256",e).update(t,"utf8").digest(i)}function C(e,t){return N.createHash("sha256").update(e,"utf8").digest(t)}function P(e){return e.replace(/[!'()*]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})}function g(e){return P(encodeURIComponent(e))}var b={authorization:!0,connection:!0,"x-amzn-trace-id":!0,"user-agent":!0,expect:!0,"presigned-expires":!0,range:!0};function s(e,t){typeof e=="string"&&(e=U.parse(e));var i=e.headers=e.headers||{},r=(!this.service||!this.region)&&this.matchHost(e.hostname||e.host||i.Host||i.host);this.request=e,this.credentials=t||this.defaultCredentials(),this.service=e.service||r[0]||"",this.region=e.region||r[1]||"us-east-1",this.service==="email"&&(this.service="ses"),!e.method&&e.body&&(e.method="POST"),!i.Host&&!i.host&&(i.Host=e.hostname||e.host||this.createHost(),e.port&&(i.Host+=":"+e.port)),!e.hostname&&!e.host&&(e.hostname=i.Host||i.host),this.isCodeCommitGit=this.service==="codecommit"&&e.method==="GIT",this.extraHeadersToIgnore=e.extraHeadersToIgnore||Object.create(null),this.extraHeadersToInclude=e.extraHeadersToInclude||Object.create(null)}s.prototype.matchHost=function(e){var t=(e||"").match(/([^\.]+)\.(?:([^\.]*)\.)?amazonaws\.com(\.cn)?$/),i=(t||[]).slice(1,3);if((i[1]==="es"||i[1]==="aoss")&&(i=i.reverse()),i[1]=="s3")i[0]="s3",i[1]="us-east-1";else for(var r=0;r<2;r++)if(/^s3-/.test(i[r])){i[1]=i[r].slice(3),i[0]="s3";break}return i};s.prototype.isSingleRegion=function(){return["s3","sdb"].indexOf(this.service)>=0&&this.region==="us-east-1"?!0:["cloudfront","ls","route53","iam","importexport","sts"].indexOf(this.service)>=0};s.prototype.createHost=function(){var e=this.isSingleRegion()?"":"."+this.region,t=this.service==="ses"?"email":this.service;return t+e+".amazonaws.com"};s.prototype.prepareRequest=function(){this.parsePath();var e=this.request,t=e.headers,i;e.signQuery?(this.parsedPath.query=i=this.parsedPath.query||{},this.credentials.sessionToken&&(i["X-Amz-Security-Token"]=this.credentials.sessionToken),this.service==="s3"&&!i["X-Amz-Expires"]&&(i["X-Amz-Expires"]=86400),i["X-Amz-Date"]?this.datetime=i["X-Amz-Date"]:i["X-Amz-Date"]=this.getDateTime(),i["X-Amz-Algorithm"]="AWS4-HMAC-SHA256",i["X-Amz-Credential"]=this.credentials.accessKeyId+"/"+this.credentialString(),i["X-Amz-SignedHeaders"]=this.signedHeaders()):(!e.doNotModifyHeaders&&!this.isCodeCommitGit&&(e.body&&!t["Content-Type"]&&!t["content-type"]&&(t["Content-Type"]="application/x-www-form-urlencoded; charset=utf-8"),e.body&&!t["Content-Length"]&&!t["content-length"]&&(t["Content-Length"]=__Buffer$.byteLength(e.body)),this.credentials.sessionToken&&!t["X-Amz-Security-Token"]&&!t["x-amz-security-token"]&&(t["X-Amz-Security-Token"]=this.credentials.sessionToken),this.service==="s3"&&!t["X-Amz-Content-Sha256"]&&!t["x-amz-content-sha256"]&&(t["X-Amz-Content-Sha256"]=C(this.request.body||"","hex")),t["X-Amz-Date"]||t["x-amz-date"]?this.datetime=t["X-Amz-Date"]||t["x-amz-date"]:t["X-Amz-Date"]=this.getDateTime()),delete t.Authorization,delete t.authorization)};s.prototype.sign=function(){return this.parsedPath||this.prepareRequest(),this.request.signQuery?this.parsedPath.query["X-Amz-Signature"]=this.signature():this.request.headers.Authorization=this.authHeader(),this.request.path=this.formatPath(),this.request};s.prototype.getDateTime=function(){if(!this.datetime){var e=this.request.headers,t=new Date(e.Date||e.date||new Date);this.datetime=t.toISOString().replace(/[:\-]|\.\d{3}/g,""),this.isCodeCommitGit&&(this.datetime=this.datetime.slice(0,-1))}return this.datetime};s.prototype.getDate=function(){return this.getDateTime().substr(0,8)};s.prototype.authHeader=function(){return["AWS4-HMAC-SHA256 Credential="+this.credentials.accessKeyId+"/"+this.credentialString(),"SignedHeaders="+this.signedHeaders(),"Signature="+this.signature()].join(", ")};s.prototype.signature=function(){var e=this.getDate(),t=[this.credentials.secretAccessKey,e,this.region,this.service].join(),i,r,o,u=E.get(t);return u||(i=f("AWS4"+this.credentials.secretAccessKey,e),r=f(i,this.region),o=f(r,this.service),u=f(o,"aws4_request"),E.set(t,u)),f(u,this.stringToSign(),"hex")};s.prototype.stringToSign=function(){return["AWS4-HMAC-SHA256",this.getDateTime(),this.credentialString(),C(this.canonicalString(),"hex")].join(`
`)};s.prototype.canonicalString=function(){this.parsedPath||this.prepareRequest();var e=this.parsedPath.path,t=this.parsedPath.query,i=this.request.headers,r="",o=this.service!=="s3",u=this.service==="s3"||this.request.doNotEncodePath,O=this.service==="s3",R=this.service==="s3",l;if(this.service==="s3"&&this.request.signQuery?l="UNSIGNED-PAYLOAD":this.isCodeCommitGit?l="":l=i["X-Amz-Content-Sha256"]||i["x-amz-content-sha256"]||C(this.request.body||"","hex"),t){var p=Object.keys(t).reduce(function(a,n){return n&&(a[g(n)]=Array.isArray(t[n])&&R?t[n][0]:t[n]),a},{}),y=[];Object.keys(p).sort().forEach(function(a){Array.isArray(p[a])?p[a].map(g).sort().forEach(function(n){y.push(a+"="+n)}):y.push(a+"="+g(p[a]))}),r=y.join("&")}return e!=="/"&&(o&&(e=e.replace(/\/{2,}/g,"/")),e=e.split("/").reduce(function(a,n){return o&&n===".."?a.pop():(!o||n!==".")&&(u&&(n=decodeURIComponent(n.replace(/\+/g," "))),a.push(g(n))),a},[]).join("/"),e[0]!=="/"&&(e="/"+e),O&&(e=e.replace(/%2F/g,"/"))),[this.request.method||"GET",e,r,this.canonicalHeaders()+`
`,this.signedHeaders(),l].join(`
`)};s.prototype.canonicalHeaders=function(){var e=this.request.headers;function t(i){return i.toString().trim().replace(/\s+/g," ")}return Object.keys(e).filter(function(i){return b[i.toLowerCase()]==null}).sort(function(i,r){return i.toLowerCase()<r.toLowerCase()?-1:1}).map(function(i){return i.toLowerCase()+":"+t(e[i])}).join(`
`)};s.prototype.signedHeaders=function(){var e=this.extraHeadersToInclude,t=this.extraHeadersToIgnore;return Object.keys(this.request.headers).map(function(i){return i.toLowerCase()}).filter(function(i){return e[i]||b[i]==null&&!t[i]}).sort().join(";")};s.prototype.credentialString=function(){return[this.getDate(),this.region,this.service,"aws4_request"].join("/")};s.prototype.defaultCredentials=function(){var e=__Process$.env;return{accessKeyId:e.AWS_ACCESS_KEY_ID||e.AWS_ACCESS_KEY,secretAccessKey:e.AWS_SECRET_ACCESS_KEY||e.AWS_SECRET_KEY,sessionToken:e.AWS_SESSION_TOKEN}};s.prototype.parsePath=function(){var e=this.request.path||"/";/[^0-9A-Za-z;,/?:@&=+$\-_.!~*'()#%]/.test(e)&&(e=encodeURI(decodeURI(e)));var t=e.indexOf("?"),i=null;t>=0&&(i=_.parse(e.slice(t+1)),e=e.slice(0,t)),this.parsedPath={path:e,query:i}};s.prototype.formatPath=function(){var e=this.parsedPath.path,t=this.parsedPath.query;return t?(t[""]!=null&&delete t[""],e+"?"+P(_.stringify(t))):e};I.RequestSigner=s;I.sign=function(e,t){return new s(e,t).sign()}});var h={};k(h,{default:()=>$});var F=T(x());c(h,T(x()));var{default:w,...M}=F,$=w!==void 0?w:M;export{$ as default};
//# sourceMappingURL=aws4.mjs.map