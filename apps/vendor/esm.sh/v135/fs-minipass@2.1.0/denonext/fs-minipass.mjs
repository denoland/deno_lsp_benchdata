/* esm.sh - esbuild bundle(fs-minipass@2.1.0) denonext production */
import __Process$ from "node:process";
import { Buffer as __Buffer$ } from "node:buffer";
import * as __0$ from "/v135/minipass@3.3.6/denonext/minipass.mjs";
import * as __1$ from "node:events";
import * as __2$ from "node:fs";
var require=n=>{const e=m=>typeof m.default<"u"?m.default:m,c=m=>Object.assign({},m);switch(n){case"minipass":return e(__0$);case"events":return e(__1$);case"fs":return e(__2$);default:throw new Error("module \""+n+"\" not found");}};
var tt=Object.create;var W=Object.defineProperty;var et=Object.getOwnPropertyDescriptor;var st=Object.getOwnPropertyNames;var it=Object.getPrototypeOf,ht=Object.prototype.hasOwnProperty;var D=(s=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(s,{get:(t,e)=>(typeof require<"u"?require:t)[e]}):s)(function(s){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+s+'" is not supported')});var rt=(s,t)=>()=>(t||s((t={exports:{}}).exports,t),t.exports),nt=(s,t)=>{for(var e in t)W(s,e,{get:t[e],enumerable:!0})},N=(s,t,e,h)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of st(t))!ht.call(s,o)&&o!==e&&W(s,o,{get:()=>t[o],enumerable:!(h=et(t,o))||h.enumerable});return s},d=(s,t,e)=>(N(s,t,"default"),e&&N(e,t,"default")),H=(s,t,e)=>(e=s!=null?tt(it(s)):{},N(t||!s||!s.__esModule?W(e,"default",{value:s,enumerable:!0}):e,s));var A=rt(q=>{"use strict";var lt=D("minipass"),ot=D("events").EventEmitter,r=D("fs"),I=r.writev;if(!I){let s=__Process$.binding("fs"),t=s.FSReqWrap||s.FSReqCallback;I=(e,h,o,X)=>{let Y=(Z,$)=>X(Z,$,h),G=new t;G.oncomplete=Y,s.writeBuffers(e,h,o,G)}}var g=Symbol("_autoClose"),n=Symbol("_close"),k=Symbol("_ended"),i=Symbol("_fd"),J=Symbol("_finished"),u=Symbol("_flags"),M=Symbol("_flush"),P=Symbol("_handleChunk"),U=Symbol("_makeBuf"),T=Symbol("_mode"),C=Symbol("_needDrain"),w=Symbol("_onerror"),E=Symbol("_onopen"),O=Symbol("_onread"),S=Symbol("_onwrite"),c=Symbol("_open"),f=Symbol("_path"),y=Symbol("_pos"),l=Symbol("_queue"),b=Symbol("_read"),K=Symbol("_readSize"),a=Symbol("_reading"),x=Symbol("_remain"),L=Symbol("_size"),z=Symbol("_write"),_=Symbol("_writing"),F=Symbol("_defaultFlag"),p=Symbol("_errored"),B=class extends lt{constructor(t,e){if(e=e||{},super(e),this.readable=!0,this.writable=!1,typeof t!="string")throw new TypeError("path must be a string");this[p]=!1,this[i]=typeof e.fd=="number"?e.fd:null,this[f]=t,this[K]=e.readSize||16*1024*1024,this[a]=!1,this[L]=typeof e.size=="number"?e.size:1/0,this[x]=this[L],this[g]=typeof e.autoClose=="boolean"?e.autoClose:!0,typeof this[i]=="number"?this[b]():this[c]()}get fd(){return this[i]}get path(){return this[f]}write(){throw new TypeError("this is a readable stream")}end(){throw new TypeError("this is a readable stream")}[c](){r.open(this[f],"r",(t,e)=>this[E](t,e))}[E](t,e){t?this[w](t):(this[i]=e,this.emit("open",e),this[b]())}[U](){return __Buffer$.allocUnsafe(Math.min(this[K],this[x]))}[b](){if(!this[a]){this[a]=!0;let t=this[U]();if(t.length===0)return __Process$.nextTick(()=>this[O](null,0,t));r.read(this[i],t,0,t.length,null,(e,h,o)=>this[O](e,h,o))}}[O](t,e,h){this[a]=!1,t?this[w](t):this[P](e,h)&&this[b]()}[n](){if(this[g]&&typeof this[i]=="number"){let t=this[i];this[i]=null,r.close(t,e=>e?this.emit("error",e):this.emit("close"))}}[w](t){this[a]=!0,this[n](),this.emit("error",t)}[P](t,e){let h=!1;return this[x]-=t,t>0&&(h=super.write(t<e.length?e.slice(0,t):e)),(t===0||this[x]<=0)&&(h=!1,this[n](),super.end()),h}emit(t,e){switch(t){case"prefinish":case"finish":break;case"drain":typeof this[i]=="number"&&this[b]();break;case"error":return this[p]?void 0:(this[p]=!0,super.emit(t,e));default:return super.emit(t,e)}}},j=class extends B{[c](){let t=!0;try{this[E](null,r.openSync(this[f],"r")),t=!1}finally{t&&this[n]()}}[b](){let t=!0;try{if(!this[a]){this[a]=!0;do{let e=this[U](),h=e.length===0?0:r.readSync(this[i],e,0,e.length,null);if(!this[P](h,e))break}while(!0);this[a]=!1}t=!1}finally{t&&this[n]()}}[n](){if(this[g]&&typeof this[i]=="number"){let t=this[i];this[i]=null,r.closeSync(t),this.emit("close")}}},R=class extends ot{constructor(t,e){e=e||{},super(e),this.readable=!1,this.writable=!0,this[p]=!1,this[_]=!1,this[k]=!1,this[C]=!1,this[l]=[],this[f]=t,this[i]=typeof e.fd=="number"?e.fd:null,this[T]=e.mode===void 0?438:e.mode,this[y]=typeof e.start=="number"?e.start:null,this[g]=typeof e.autoClose=="boolean"?e.autoClose:!0;let h=this[y]!==null?"r+":"w";this[F]=e.flags===void 0,this[u]=this[F]?h:e.flags,this[i]===null&&this[c]()}emit(t,e){if(t==="error"){if(this[p])return;this[p]=!0}return super.emit(t,e)}get fd(){return this[i]}get path(){return this[f]}[w](t){this[n](),this[_]=!0,this.emit("error",t)}[c](){r.open(this[f],this[u],this[T],(t,e)=>this[E](t,e))}[E](t,e){this[F]&&this[u]==="r+"&&t&&t.code==="ENOENT"?(this[u]="w",this[c]()):t?this[w](t):(this[i]=e,this.emit("open",e),this[M]())}end(t,e){return t&&this.write(t,e),this[k]=!0,!this[_]&&!this[l].length&&typeof this[i]=="number"&&this[S](null,0),this}write(t,e){return typeof t=="string"&&(t=__Buffer$.from(t,e)),this[k]?(this.emit("error",new Error("write() after end()")),!1):this[i]===null||this[_]||this[l].length?(this[l].push(t),this[C]=!0,!1):(this[_]=!0,this[z](t),!0)}[z](t){r.write(this[i],t,0,t.length,this[y],(e,h)=>this[S](e,h))}[S](t,e){t?this[w](t):(this[y]!==null&&(this[y]+=e),this[l].length?this[M]():(this[_]=!1,this[k]&&!this[J]?(this[J]=!0,this[n](),this.emit("finish")):this[C]&&(this[C]=!1,this.emit("drain"))))}[M](){if(this[l].length===0)this[k]&&this[S](null,0);else if(this[l].length===1)this[z](this[l].pop());else{let t=this[l];this[l]=[],I(this[i],t,this[y],(e,h)=>this[S](e,h))}}[n](){if(this[g]&&typeof this[i]=="number"){let t=this[i];this[i]=null,r.close(t,e=>e?this.emit("error",e):this.emit("close"))}}},v=class extends R{[c](){let t;if(this[F]&&this[u]==="r+")try{t=r.openSync(this[f],this[u],this[T])}catch(e){if(e.code==="ENOENT")return this[u]="w",this[c]();throw e}else t=r.openSync(this[f],this[u],this[T]);this[E](null,t)}[n](){if(this[g]&&typeof this[i]=="number"){let t=this[i];this[i]=null,r.closeSync(t),this.emit("close")}}[z](t){let e=!0;try{this[S](null,r.writeSync(this[i],t,0,t.length,this[y])),e=!1}finally{if(e)try{this[n]()}catch{}}}};q.ReadStream=B;q.ReadStreamSync=j;q.WriteStream=R;q.WriteStreamSync=v});var m={};nt(m,{ReadStream:()=>ft,ReadStreamSync:()=>at,WriteStream:()=>ut,WriteStreamSync:()=>ct,default:()=>dt});var V=H(A());d(m,H(A()));var{ReadStream:ft,ReadStreamSync:at,WriteStream:ut,WriteStreamSync:ct}=V,{default:Q,...mt}=V,dt=Q!==void 0?Q:mt;export{ft as ReadStream,at as ReadStreamSync,ut as WriteStream,ct as WriteStreamSync,dt as default};
//# sourceMappingURL=fs-minipass.mjs.map